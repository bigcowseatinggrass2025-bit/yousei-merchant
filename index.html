<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¹½è¡—å•†äºº - æ¡ŒéŠè¨ˆåˆ†å™¨</title>
	    /* ==================== CSS å˜é‡å’ŒåŸºç¡€æ ·å¼CSSè§„åˆ™ ==================== */
    <style>
        /* CSS å˜é‡å®šä¹‰ */
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --success-color: #2ecc71;
            --danger-color: #e74c3c;
            --warning-color: #f39c12;
            --info-color: #1abc9c;
            --light-color: #ecf0f1;
            --dark-color: #34495e;
            --rarity-normal: #ffffff;
            --rarity-magic: #8888ff;
            --rarity-rare: #ffff00;
            --rarity-epic: #ff44ff;
            --rarity-legendary: #ff8800;
            --rarity-divine: #ffcc00;
            --ghost-color: #3498db;
            --fairy-color: #9b59b6;
            --king-color: #2c3e50;
            --special-event-color: #8e44ad;
            --guardian-bull: #8B4513;
            --guardian-tiger: #9E9E9E;
            --guardian-dragon: #008080;
            --guardian-phoenix: #FF4500;
            --guardian-turtle: #006400;
        }


/* å¼ºåŒ–è§‰é†’æŠ¤æ³•çš„å‘å…‰æ•ˆæœ */
.player-card.has-guardian.evolved {
    animation: evolved-glow-intense 1.5s infinite alternate;
    border-width: 3px;
    position: relative;
    overflow: visible;
    z-index: 2;
}

/* æ›´å¼ºçƒˆçš„å‘å…‰æ•ˆæœ */
@keyframes evolved-glow-intense {
    from { 
        box-shadow: 0 0 20px var(--guardian-color),
                   0 0 40px rgba(255, 255, 255, 0.8),
                   0 0 60px var(--guardian-color);
    }
    to { 
        box-shadow: 0 0 40px var(--guardian-color),
                   0 0 80px rgba(255, 255, 255, 1),
                   0 0 120px var(--guardian-color),
                   0 0 160px var(--guardian-color);
    }
}

/* æ·»åŠ è„‰åŠ¨æ•ˆæœ */
@keyframes pulse-glow {
    0% {
        transform: scale(1);
        opacity: 0.8;
    }
    50% {
        transform: scale(1.03);
        opacity: 1;
    }
    100% {
        transform: scale(1);
        opacity: 0.8;
    }
}

/* æ·»åŠ ç²’å­æ•ˆæœå®¹å™¨ */
.particle-container {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 1;
    border-radius: 10px;
    overflow: hidden;
}

/* ç²’å­æ ·å¼ */
.particle {
    position: absolute;
    background: radial-gradient(circle, var(--particle-color) 0%, transparent 70%);
    border-radius: 50%;
    opacity: 0;
    animation: particle-float 3s infinite linear;
}

@keyframes particle-float {
    0% {
        transform: translateY(100%) translateX(0);
        opacity: 0;
        width: 2px;
        height: 2px;
    }
    10% {
        opacity: 0.7;
    }
    90% {
        opacity: 0.7;
    }
    100% {
        transform: translateY(-100%) translateX(var(--translate-x));
        opacity: 0;
        width: 1px;
        height: 1px;
    }
}

/* ç¥å…½è§‰é†’æŒ‰é’®ç‰¹æ•ˆå¢å¼º */
.evolution-trigger-btn.evolved {
    animation: evolved-btn-glow 1s infinite alternate;
    background: linear-gradient(135deg, #ff6b6b, #c0392b, #ff6b6b);
    background-size: 200% 100%;
    animation: evolved-btn-glow 1.5s infinite alternate, gradient-shift 2s infinite alternate;
}

@keyframes evolved-btn-glow {
    from { 
        box-shadow: 0 0 5px #ff6b6b,
                   0 0 10px #ff0000;
    }
    to { 
        box-shadow: 0 0 15px #ff6b6b,
                   0 0 25px #ff0000,
                   0 0 35px #ff6b6b;
    }
}

@keyframes gradient-shift {
    0% {
        background-position: 0% 50%;
    }
    100% {
        background-position: 100% 50%;
    }
}

/* æ·»åŠ ç¥å…½è§‰é†’æ ‡è¯† */
.guardian-evolved-badge {
    position: absolute;
    top: -10px;
    right: -10px;
    width: 30px;
    height: 30px;
    background: gold;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #000;
    font-weight: bold;
    font-size: 16px;
    z-index: 10;
    animation: badge-pulse 2s infinite;
    box-shadow: 0 0 15px gold;
}

@keyframes badge-pulse {
    0%, 100% {
        transform: scale(1);
    }
    50% {
        transform: scale(1.2);
    }
}

/* æ·»åŠ è¾¹æ¡†æµåŠ¨å…‰æ•ˆ */
.glow-border {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border-radius: 10px;
    overflow: hidden;
    pointer-events: none;
}

.glow-border::before {
    content: '';
    position: absolute;
    top: -150%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: linear-gradient(
        to bottom right,
        transparent,
        transparent,
        transparent,
        var(--guardian-color),
        transparent,
        transparent,
        transparent
    );
    animation: border-glow-flow 3s infinite linear;
    transform: rotate(45deg);
}

@keyframes border-glow-flow {
    0% {
        top: -150%;
    }
    100% {
        top: 150%;
    }
}

        /* åŸºç¡€æ ·å¼ */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Microsoft YaHei', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-image: url('https://imgur.com/HRitVLT.jpg');
            background-size: 100% 100%;
            background-position: 70% center;
            background-repeat: no-repeat;
            background-attachment: fixed;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            margin: 0;
            padding: 20px 0;
        }
        
        .container {
            width: 100%;
            max-width: 1200px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            margin: 20px auto !important;
            transform: translateX(-350px);
        }
        
        /* å¤´éƒ¨æ ·å¼ */
        header {
            background: var(--primary-color);
            color: white;
            padding: 2px;
            text-align: center;
            position: relative;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        /* ç©å®¶è®¾ç½®åŒºåŸŸ */
        .player-setup {
            padding: 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            background: var(--light-color);
            border-bottom: 2px solid #bdc3c7;
        }
        
        .input-group {
            flex: 1;
            min-width: 250px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: var(--dark-color);
        }
        
        input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }
        
        input:focus {
            border-color: var(--secondary-color);
            outline: none;
        }
        
        /* æŒ‰é’®æ ·å¼ */
        button {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .btn-primary {
            background: var(--secondary-color);
            color: white;
        }
        
        .btn-primary:hover {
            background: #2980b9;
        }
        
        .btn-success {
            background: var(--success-color);
            color: white;
        }
        
        .btn-success:hover {
            background: #27ae60;
        }
        
        .btn-danger {
            background: var(--danger-color);
            color: white;
        }
        
        .btn-danger:hover {
            background: #c0392b;
        }
        
        .btn-warning {
            background: var(--warning-color);
            color: white;
        }
        
        .btn-warning:hover {
            background: #e67e22;
        }
        
        .btn-warehouse {
            background: linear-gradient(135deg, #6b3fa0, #4a235a);
            color: white;
            margin-top: 5px;
            width: 100%;
            display: none;
            border: 2px solid #8e44ad;
            font-weight: bold;
            position: relative;
            overflow: hidden;
            animation: warehouse-glow 2s infinite alternate;
        }
        
        .btn-warehouse:hover {
            background: linear-gradient(135deg, #7d4fb2, #5c2c6d);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(142, 68, 173, 0.4);
        }
        
        /* èµ°é©¬ç¯æ ·å¼ */
        .marquee-container {
            padding: 15px 20px;
            background: #2c3e50;
            color: white;
            border-bottom: 2px solid #1a2530;
            overflow: hidden;
            position: relative;
            min-height: 60px;
            display: flex;
            align-items: center;
        }
        
        .marquee-content {
            position: absolute;
            white-space: nowrap;
            animation: marquee 30s linear infinite;
            font-size: 1.2rem;
            font-weight: bold;
            padding-left: 100%;
        }
        
        .marquee-content.priority {
            animation: marquee-priority 30s linear forwards;
            color: #ff6b6b;
            font-weight: bold;
        }
        
        .marquee-content.special {
            animation: marquee-priority 30s linear forwards;
            color: #d8bfd8;
            font-weight: bold;
            text-shadow: 0 0 10px rgba(142, 68, 173, 0.8);
        }
        
        /* éš¾åº¦é€‰æ‹©æŒ‰é’®æ ·å¼ */
        .difficulty-toggle {
            position: fixed;
            bottom: 60px;
            right: 20px;
            z-index: 1001;
            background: rgba(44, 62, 80, 0.8);
            padding: 8px 12px;
            border-radius: 20px;
            color: white;
            font-size: 0.9rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .difficulty-toggle span {
            padding: 4px 8px;
            border-radius: 12px;
            transition: all 0.3s;
        }
        
        .difficulty-toggle .easy {
            background: var(--success-color);
        }
        
        .difficulty-toggle .hard {
            background: var(--danger-color);
        }
        
        .difficulty-toggle .active {
            font-weight: bold;
            box-shadow: 0 0 8px rgba(255, 255, 255, 0.7);
        }
        
        /* ä¸»å†…å®¹åŒºåŸŸ */
        .main-content {
            display: flex;
            flex-wrap: wrap;
            padding: 20px;
            gap: 20px;
        }
        
        .players-container {
            flex: 2;
            min-width: 300px;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }
        
        /* ç©å®¶å¡ç‰‡æ ·å¼ */
        .player-card {
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            padding: 20px;
            display: flex;
            flex-direction: column;
            transition: all 0.3s;
            border-left: 5px solid var(--secondary-color);
            position: relative;
        }
        
        .player-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }
        
        .player-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .player-name {
            font-size: 1.4rem;
            font-weight: bold;
            color: var(--primary-color);
        }
        
        .player-stats {
            margin-bottom: 15px;
        }
        
        .stat-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }
        
        .stat-label {
            font-weight: bold;
            color: var(--dark-color);
        }
        
        .lottery-history {
            margin-top: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px dashed #ddd;
        }
        
        .lottery-history span {
            display: inline-block;
            margin: 3px;
            padding: 5px 10px;
            background: var(--info-color);
            color: white;
            border-radius: 15px;
            font-size: 0.9rem;
        }
        
        .trade-btn {
            margin-top: auto;
            padding: 15px;
            font-size: 1.2rem;
            background: var(--success-color);
        }
        
        .trade-btn:hover {
            background: #27ae60;
        }
        
        /* äº‹ä»¶å®¹å™¨æ ·å¼ */
        .events-container {
            flex: 1;
            min-width: 300px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            padding: 20px;
            max-height: 600px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }
        
        .events-title {
            font-size: 1.5rem;
            color: var(--primary-color);
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--info-color);
        }
        
        .events-list {
            flex: 1;
            overflow-y: auto;
        }
        
        .event-item {
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 8px;
            background: #f8f9fa;
            border-left: 4px solid var(--info-color);
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .event-item:hover {
            background: #e9ecef;
            transform: translateX(5px);
        }
        
        .event-global {
            border-left-color: var(--warning-color);
            background: #fffaf0;
        }
        
        .event-individual {
            border-left-color: var(--danger-color);
            background: #fff5f5;
        }
        
        .event-lottery {
            border-left-color: #9b59b6;
            background: #f8f0ff;
        }
        
        .event-special {
            border-left-color: var(--special-event-color);
            background: #f4eef8;
            color: var(--special-event-color);
        }
        
        /* é€²åŒ–æ¨¡æ…‹æ¡†æ¨£å¼ */
        .evolution-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .evolution-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            width: 90%;
            max-width: 500px;
            text-align: center;
            position: relative;
            box-shadow: 0 0 25px rgba(0, 0, 0, 0.7);
        }
        
        .evolution-info {
            display: flex;
            margin: 20px 0;
            gap: 15px;
        }
        
        .evolution-cost, .evolution-benefits {
            flex: 1;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            text-align: left;
        }
        
        .evolution-cost h3, .evolution-benefits h3 {
            margin-bottom: 10px;
            color: var(--primary-color);
            border-bottom: 1px solid #ddd;
            padding-bottom: 5px;
        }
        
        /* é€²åŒ–æŒ‰éˆ•æ¨£å¼ */
        .evolution-btn {
            background: linear-gradient(135deg, #ff6b6b, #c0392b);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
            font-weight: bold;
            animation: evolution-glow 2s infinite alternate;
            width: 100%;
        }
        
        @keyframes evolution-glow {
            from { box-shadow: 0 0 10px #ff6b6b; }
            to { box-shadow: 0 0 20px #ff6b6b, 0 0 30px #ff0000; }
        }
        
        /* å·²é€²åŒ–çš„è­·æ³•æ•ˆæœ */
        .guardian-effect.evolved {
            animation: evolved-glow 1.5s infinite alternate;
        }
        
        @keyframes evolved-glow {
            from { 
                box-shadow: 0 0 10px var(--guardian-color), 
                           0 0 20px rgba(255, 255, 255, 0.8);
            }
            to { 
                box-shadow: 0 0 20px var(--guardian-color), 
                           0 0 40px rgba(255, 255, 255, 1),
                           0 0 60px var(--guardian-color);
            }
        }
        
        /* æ¨¡æ€æ¡†æ ·å¼ */
        .lottery-modal, .guess-modal, .merchant-modal, .warehouse-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .lottery-content, .guess-content, .merchant-content, .warehouse-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            width: 90%;
            max-width: 600px;
            text-align: center;
            position: relative;
        }
        
        .close-modal {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--danger-color);
        }
        
        /* å½©ç¥¨å·ç æ ·å¼ */
        .lottery-numbers {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin: 20px 0;
        }
        
        .number-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        
        .number-circle.selected {
            background: var(--success-color);
            transform: scale(1.1);
        }
        
        .number-circle.taken {
            background: #95a5a6;
            cursor: not-allowed;
            opacity: 0.6;
        }
        
        .number-circle:hover:not(.taken) {
            transform: scale(1.1);
        }
        
        .error-message {
            color: var(--danger-color);
            margin: 10px 0;
            font-weight: bold;
            min-height: 20px;
        }
        
        .draw-animation {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin: 20px 0;
            min-height: 100px;
            align-items: center;
        }
        
        .draw-number {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--warning-color);
            color: white;
            font-weight: bold;
            font-size: 1.5rem;
            box-shadow: 0 0 15px rgba(243, 156, 18, 0.5);
        }
        
        .winner-display {
            margin: 20px 0;
            padding: 15px;
            background: #f0fff0;
            border-radius: 10px;
            border: 2px solid var(--success-color);
        }
        
        /* å½©ç¥¨æ ‡é¢˜é¢œè‰²å˜æ¢æ•ˆæœ */
        .lottery-content h2 {
            background: linear-gradient(
                90deg, 
                #ff0000, #ff8000, #ffff00, #80ff00, 
                #00ff00, #00ff80, #00ffff, #0080ff, 
                #0000ff, #8000ff, #ff00ff, #ff0080, #ff0000
            );
            background-size: 1200% 100%;
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            animation: rainbowText 8s linear infinite;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        /* ç¥ç§˜å•†äººæ ·å¼ */
        .merchant-content {
            background: rgba(43, 45, 66, 0.95);
            border-radius: 15px;
            padding: 30px;
            width: 90%;
            max-width: 800px;
            text-align: center;
            position: relative;
            box-shadow: 0 0 25px rgba(0, 0, 0, 0.7);
            color: #f1f1f1;
            border: 1px solid rgba(255, 215, 0, 0.3);
            backdrop-filter: blur(5px);
        }

        /* ä»“åº“æ ·å¼ */
        .warehouse-content {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            width: 90%;
            max-width: 700px;
            text-align: center;
            position: relative;
            box-shadow: 0 0 25px rgba(0, 0, 0, 0.7);
            border: 2px solid rgba(52, 152, 219, 0.5);
        }

        .warehouse-content h2 {
            background: linear-gradient(90deg, #3498db, #2c3e50);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 20px;
            font-size: 1.8rem;
            font-weight: bold;
            padding: 5px 0;
        }

        /* ç¥ç§˜å•†äººæ ‡é¢˜å¹»å½©ç¯å…‰æ•ˆæœ */
        .merchant-content h2 {
            background: linear-gradient(90deg, #ff0000, #ff8000, #ffff00, #80ff00, #00ff00, #00ff80, #00ffff, #0080ff, #0000ff, #8000ff, #ff00ff, #ff0080, #ff0000);
            background-size: 1200% 100%;
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            animation: rainbowText 8s linear infinite;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
            margin-bottom: 15px;
            font-size: 2rem;
            font-weight: bold;
            padding: 5px 0;
        }

        /* å¡ç‰‡å®¹å™¨ */
        .merchant-cards, .warehouse-cards {
            display: grid;
            gap: 15px;
            margin: 20px 0;
        }
        
        .merchant-cards {
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
        }
        
        .warehouse-cards {
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
        }
        
        .merchant-card, .warehouse-card {
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .warehouse-card {
            padding: 12px;
            border-radius: 8px;
            position: relative;
        }
        
        .merchant-card:hover, .warehouse-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .merchant-card.selected, .warehouse-card.selected {
            border-color: var(--success-color);
            background-color: #f0fff0;
            transform: scale(1.05);
        }
        
        .merchant-card .card-name {
            font-weight: bold;
            margin-bottom: 5px;
            color: white;
        }
        
        .warehouse-card .card-name {
            font-weight: bold;
            margin-bottom: 4px;
            font-size: 0.9rem;
        }
        
        .merchant-card .card-cost {
            color: var(--warning-color);
            font-size: 0.9rem;
        }
        
        .merchant-card .card-desc {
            font-size: 0.8rem;
            color: #f0f0f0;
            margin-top: 5px;
        }
        
        .warehouse-card .card-desc {
            font-size: 0.75rem;
            margin-top: 4px;
            line-height: 1.2;
        }
        
        .warehouse-card .card-prices {
            margin-top: 5px;
            font-size: 0.7rem;
            font-weight: bold;
        }
        
        .warehouse-card .card-circles {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 3px;
            margin: 5px 0;
        }
        
        /* ç¥å…½è§‰é†’æŒ‰é’®æ ·å¼ */
        .evolution-trigger-btn {
            background: linear-gradient(135deg, #ff6b6b, #c0392b);
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8rem;
            margin-left: 10px;
            animation: evolution-pulse 2s infinite;
        }
        
        @keyframes evolution-pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); box-shadow: 0 0 10px #ff6b6b; }
            100% { transform: scale(1); }
        }
        
        .evolution-trigger-btn:hover {
            background: linear-gradient(135deg, #c0392b, #a93226);
            animation: none;
        }
        
        .warehouse-card .goods-circle {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.6rem;
            font-weight: bold;
        }
        
        /* ç©å®¶å¡ç‰‡åŒºåŸŸ */
        .cards-container {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 5px;
        }
        
        .player-card-item {
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            cursor: pointer;
            margin: 3px;
            border: 1px solid #ddd;
            font-weight: bold;
        }
        
        .player-card-item.normal {
            background: var(--rarity-normal);
            color: #222;
            border-color: #ccc;
        }
        
        .player-card-item.magic {
            background: var(--rarity-magic);
            color: white;
            border-color: #6666cc;
        }
        
        .player-card-item.rare {
            background: var(--rarity-rare);
            color: #664400;
            border-color: #cccc00;
        }
        
        .player-card-item.epic {
            background: var(--rarity-epic);
            color: white;
            border-color: #cc00cc;
        }
        
        .player-card-item.legendary {
            background: var(--rarity-legendary);
            color: #fff0e0;
            border-color: #ffaa00;
            animation: subtle-glow 3s infinite alternate;
        }
        
        .player-card-item.divine {
            background: var(--rarity-divine);
            color: #333;
            border-color: #cc9900;
            animation: divine-black-glow 2s infinite alternate;
        }
        
        .player-card-item.ghost {
            background: var(--ghost-color);
            color: white;
            border-color: #2980b9;
            animation: ghost-glow 2s infinite alternate;
        }
        
        .player-card-item.fairy {
            background: var(--fairy-color);
            color: white;
            border-color: #8e44ad;
            animation: fairy-glow 2s infinite alternate;
        }
        
        .player-card-item.king {
            background: var(--king-color);
            color: white;
            border-color: #1c2833;
            animation: king-glow 2s infinite alternate;
        }
        
        .player-card-item:hover {
            opacity: 0.8;
            transform: translateY(-2px);
        }
        
        .player-cards-section {
            margin-top: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px dashed #ddd;
        }
        
        /* é¡µè„šæ ·å¼ */
        footer {
            text-align: center;
            color: white;
            padding: 15px;
            background: rgba(44, 62, 80, 0.8);
            width: 100%;
            position: fixed;
            bottom: 0;
            left: 0;
            z-index: 1000;
        }
        
        /* è­·æ³•æ•ˆæœæ¨£å¼ */
        .guardian-effect {
            padding: 10px;
            border-radius: 10px;
            margin-top: 8px;
            animation: guardian-glow 1.5s infinite alternate;
            font-weight: bold;
            text-shadow: 0 0 5px rgba(255, 255, 255, 0.8);
        }
        
        .guardian-effect-bull {
            background: rgba(139, 69, 19, 0.2);
            border: 1px solid #8B4513;
            box-shadow: 0 0 10px rgba(139, 69, 19, 0.5);
            color: #8B4513;
            --guardian-color: #8B4513;
        }
        
        .guardian-effect-tiger {
            background: rgba(158, 158, 158, 0.2);
            border: 1px solid #9E9E9E;
            box-shadow: 0 0 10px rgba(158, 158, 158, 0.5);
            color: #2c3e50;
            --guardian-color: #9E9E9E;
        }
        
        .guardian-effect-dragon {
            background: rgba(0, 128, 128, 0.2);
            border: 1px solid #008080;
            box-shadow: 0 0 10px rgba(0, 128, 128, 0.5);
            color: #008080;
            --guardian-color: #008080;
        }
        
        .guardian-effect-phoenix {
            background: rgba(255, 69, 0, 0.2);
            border: 1px solid #FF4500;
            box-shadow: 0 0 10px rgba(255, 69, 0, 0.5);
            color: #FF4500;
            --guardian-color: #FF4500;
        }
        
        .guardian-effect-turtle {
            background: rgba(0, 100, 0, 0.2);
            border: 1px solid #006400;
            box-shadow: 0 0 10px rgba(0, 100, 0, 0.5);
            color: #006400;
            --guardian-color: #006400;
        }
        
        .guardian-text {
            font-weight: bold;
            font-size: 0.9rem;
        }
        
        /* è´§ç‰©é¢œè‰² */
        .goods-fanhuo { background: #27ae60; } /* ç•ªè´§ - ç»¿è‰² */
        .goods-wenwan { background: #9b59b6; } /* æ–‡ç© - ç´«è‰² */
        .goods-yishou { background: #2980b9; } /* å¼‚å…½ - æ·±è“è‰² */
        .goods-yantie { background: #3498db; } /* ç›é“ - æµ…è“è‰² */
        .goods-huoqi { background: #e74c3c; }  /* ç«å™¨ - çº¢è‰² */
        .goods-qiwu { background: #f39c12; }   /* å¥‡ç‰© - æ©™è‰² */
        
        /* è§£é™¤æŠ¤æ³•æŒ‰é’® */
        .remove-guardian-btn {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8rem;
            margin-left: 10px;
        }

        .remove-guardian-btn:hover {
            background: linear-gradient(135deg, #c0392b, #a93226);
        }
        
        /* è­·æ³•é™ä¸´æ•ˆæœ */
        .guardian-arrival {
            position: fixed;
            top: -100vh;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-size: cover;
            background-position: center center;
            z-index: 9999;
            transition: top 8s ease-in-out;
            display: none;
            opacity: 1;
        }

        .guardian-arrival.active {
            top: 0;
        }

        .guardian-arrival.fade-out {
            opacity: 0;
            transition: opacity 5s ease-in-out;
        }

        .guardian-arrival.bull {
            background-image: url('https://imgur.com/fKa3ebt.jpg');
        }

        .guardian-arrival.tiger {
            background-image: url('https://imgur.com/COJnCXH.jpg');
        }

        .guardian-arrival.dragon {
            background-image: url('https://imgur.com/iDs3ZIS.jpg');
        }

        .guardian-arrival.phoenix {
            background-image: url('https://imgur.com/bmygtSe.jpg');
        }

        .guardian-arrival.turtle {
            background-image: url('https://imgur.com/mdSIIkz.jpg');
        }
		    /* æ–°å¢ï¼šé€²åŒ–åœ–ç‰‡æ˜ å°„ */
        .guardian-arrival.evolved.bull {
            background-image: url('https://imgur.com/Ph8b0iC.jpg');
        }
        .guardian-arrival.evolved.dragon {
            background-image: url('https://imgur.com/u78PMgP.jpg');
        }
        .guardian-arrival.evolved.tiger {
            background-image: url('https://example.com/aaaa.jpg');
        }
        .guardian-arrival.evolved.phoenix {
            background-image: url('https://imgur.com/Tt7n0gC.jpg');
        }
		.guardian-arrival.evolved.turtle {
            background-image: url('https://imgur.com/9Ize9WC.jpg');
        }
        
        /* é»‘è‰²é®ç½©æ•ˆæœ */
        .black-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.95);
            z-index: 9998;
            display: none;
            opacity: 0;
            transition: opacity 1.5s ease-in-out;
        }

        .black-overlay.active {
            opacity: 1;
        }

        .black-overlay.fade-out {
            opacity: 0;
        }

        /* ç¡®ä¿æŠ¤æ³•é™ä¸´å±‚åœ¨é»‘è‰²é®ç½©ä¹‹ä¸Š */
        .guardian-arrival {
            z-index: 9999; /* ç¡®ä¿è¿™ä¸ªå€¼æ¯”.black-overlayå¤§ */
        }
        
        /* åŠ¨ç”»å…³é”®å¸§ */
        @keyframes marquee {
            0% { transform: translateX(0); }
            100% { transform: translateX(-100%); }
        }
        
        @keyframes marquee-priority {
            0% { transform: translateX(0); }
            100% { transform: translateX(-100%); }
        }
        
        @keyframes warehouse-glow {
            from {
                box-shadow: 0 0 5px #8e44ad,
                           0 0 10px rgba(142, 68, 173, 0.3),
                           0 0 15px rgba(142, 68, 173, 0.2);
            }
            to {
                box-shadow: 0 0 15px #8e44ad,
                           0 0 25px rgba(142, 68, 173, 0.5),
                           0 0 35px rgba(142, 68, 173, 0.4),
                           0 0 45px rgba(142, 68, 173, 0.3);
            }
        }
        
        @keyframes flash {
            0%, 100% { 
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
                transform: scale(1);
            }
            50% {
                box-shadow: 0 0 20px rgba(255, 215, 0, 0.8);
                transform: scale(1.05);
            }
        }
        
        @keyframes subtle-glow {
            from { box-shadow: 0 0 3px var(--rarity-legendary); }
            to { box-shadow: 0 0 8px var(--rarity-legendary); }
        }

        @keyframes divine-black-glow {
            from { 
                box-shadow: 0 0 5px var(--rarity-divine),
                           0 0 10px rgba(0, 0, 0, 0.3);
                transform: scale(1);
            }
            to { 
                box-shadow: 0 0 15px var(--rarity-divine),
                           0 0 30px rgba(0, 0, 0, 0.8),
                           0 0 45px var(--rarity-divine);
                transform: scale(1.05);
            }
        }

        @keyframes ghost-glow {
            from { box-shadow: 0 0 5px var(--ghost-color); }
            to { box-shadow: 0 0 15px var(--ghost-color), 0 0 25px #3498db; }
        }

        @keyframes fairy-glow {
            from { box-shadow: 0 0 5px var(--fairy-color); }
            to { box-shadow: 0 0 15px var(--fairy-color), 0 0 25px #9b59b6; }
        }

        @keyframes king-glow {
            from { box-shadow: 0 0 5px var(--king-color); }
            to { box-shadow: 0 0 15px var(--king-color), 0 0 25px #2c3e50; }
        }
		// åˆ›å»ºç²’å­æ•ˆæœ
function createParticleEffect(cardElement, guardianColor) {
    const particleContainer = document.createElement('div');
    particleContainer.className = 'particle-container';
    
    // åˆ›å»ºå¤šä¸ªç²’å­
    for (let i = 0; i < 15; i++) {
        const particle = document.createElement('div');
        particle.className = 'particle';
        particle.style.setProperty('--particle-color', guardianColor);
        particle.style.setProperty('--translate-x', `${Math.random() * 40 - 20}px`);
        particle.style.left = `${Math.random() * 100}%`;
        particle.style.animationDelay = `${Math.random() * 3}s`;
        particleContainer.appendChild(particle);
    }
    
    cardElement.appendChild(particleContainer);
    
    // æ·»åŠ æµåŠ¨å…‰æ•ˆè¾¹æ¡†
    const glowBorder = document.createElement('div');
    glowBorder.className = 'glow-border';
    cardElement.appendChild(glowBorder);
    
    // æ·»åŠ è§‰é†’æ ‡è¯†
    const evolvedBadge = document.createElement('div');
    evolvedBadge.className = 'guardian-evolved-badge';
    evolvedBadge.innerHTML = 'ç¥';
    cardElement.appendChild(evolvedBadge);
}

        /* å•†äººå¡ç‰‡å…‰å½±æ•ˆæœ */
        .merchant-card.normal {
            border: 2px solid var(--rarity-normal);
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.3));
        }

        .merchant-card.magic {
            border: 2px solid var(--rarity-magic);
            background: linear-gradient(135deg, rgba(136, 136, 255, 0.1), rgba(136, 136, 255, 0.3));
            animation: magic-glow 2s infinite alternate;
        }

        .merchant-card.rare {
            border: 2px solid var(--rarity-rare);
            background: linear-gradient(135deg, rgba(255, 255, 0, 0.1), rgba(255, 255, 0, 0.3));
            animation: rare-glow 2s infinite alternate;
        }

        .merchant-card.epic {
            border: 2px solid var(--rarity-epic);
            background: linear-gradient(135deg, rgba(255, 68, 255, 0.1), rgba(255, 68, 255, 0.3));
            animation: epic-glow 1.5s infinite alternate;
        }

        .merchant-card.legendary {
            border: 2px solid var(--rarity-legendary);
            background: linear-gradient(135deg, rgba(255, 136, 0, 0.1), rgba(255, 136, 0, 0.3));
            animation: legendary-glow 1s infinite alternate;
        }

        .merchant-card.divine {
            border: 2px solid var(--rarity-divine);
            background: linear-gradient(135deg, rgba(255, 204, 0, 0.1), rgba(255, 204, 0, 0.3));
            animation: divine-glow 0.8s infinite alternate;
        }

        /* å¹½è¡—è´§å¡å…‰å½±æ•ˆæœ */
        .warehouse-card.ghost {
            border: 2px solid var(--ghost-color);
            background: linear-gradient(135deg, rgba(52, 152, 219, 0.1), rgba(52, 152, 219, 0.3));
            animation: ghost-glow 2s infinite alternate;
        }

        .warehouse-card.fairy {
            border: 2px solid var(--fairy-color);
            background: linear-gradient(135deg, rgba(155, 89, 182, 0.1), rgba(155, 89, 182, 0.3));
            animation: fairy-glow 1.5s infinite alternate;
        }

        .warehouse-card.king {
            border: 2px solid var(--king-color);
            background: linear-gradient(135deg, rgba(44, 62, 80, 0.1), rgba(44, 62, 80, 0.3));
            animation: king-glow 1s infinite alternate;
        }

        /* é­”æ³•å¡ç»¿è‰²å…‰æ•ˆ */
        @keyframes magic-glow {
            from { box-shadow: 0 0 5px var(--rarity-magic); }
            to { box-shadow: 0 0 15px #00ff00, 0 0 25px var(--rarity-magic); }
        }

        /* ç¨€æœ‰å¡è“è‰²å…‰æ•ˆ */
        @keyframes rare-glow {
            from { box-shadow: 0 0 5px var(--rarity-rare); }
            to { box-shadow: 0 0 15px #0066ff, 0 0 25px var(--rarity-rare); }
        }

        /* å²è¯—å¡ç´«è‰²å…‰æ•ˆ */
        @keyframes epic-glow {
            from { box-shadow: 0 0 5px var(--rarity-epic); }
            to { box-shadow: 0 0 15px #cc00ff, 0 0 25px var(--rarity-epic), 0 0 35px #cc00ff; }
        }

        /* ä¼ å¥‡å¡æ©™è‰²å…‰æ•ˆ */
        @keyframes legendary-glow {
            from { box-shadow: 0 0 5px var(--rarity-legendary); }
            to { box-shadow: 0 0 15px var(--rarity-legendary), 
                           0 0 25px #ff5500, 
                           0 0 35px var(--rarity-legendary); }
        }

        /* ç¥åœ£å¡é‡‘è‰²å…‰æ•ˆ */
        @keyframes divine-glow {
            from { box-shadow: 0 0 5px var(--rarity-divine); }
            to { box-shadow: 0 0 15px var(--rarity-divine), 
                           0 0 25px #ffcc00, 
                           0 0 35px var(--rarity-divine),
                           0 0 45px #ffcc00; }
        }

        /* é€‰ä¸­çš„å¡ç‰‡æ•ˆæœ */
        .merchant-card.selected {
            transform: scale(1.05);
            animation: selected-glow 0.5s infinite alternate;
        }

        @keyframes selected-glow {
            from { box-shadow: 0 0 10px var(--success-color); }
            to { box-shadow: 0 0 20px var(--success-color), 0 0 30px #00ff00; }
        }
        
        /* è­·æ³•ç™¼å…‰å‹•ç•« */
        @keyframes guardian-glow {
            from {
                box-shadow: 0 0 5px var(--guardian-color);
            }
            to {
                box-shadow: 0 0 15px var(--guardian-color),
                           0 0 20px var(--guardian-color);
            }
        }

        /* ç©å®¶å¡ç‰‡è­·æ³•æ•ˆæœ */
        .player-card.has-guardian {
            animation: card-glow 3s infinite alternate;
            border: 2px solid var(--guardian-color);
        }

        @keyframes card-glow {
            from {
                box-shadow: 0 0 10px var(--guardian-color),
                           0 0 20px rgba(255, 255, 255, 0.3);
            }
            to {
                box-shadow: 0 0 25px var(--guardian-color),
                           0 0 40px var(--guardian-color),
                           0 0 60px rgba(255, 255, 255, 0.6),
                           0 0 80px var(--guardian-color);
            }
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
            
            .player-card {
                min-width: 100%;
            }
            
            .events-container {
                min-width: 100%;
            }
            
            .lottery-numbers {
                gap: 5px;
            }
            
            .number-circle {
                width: 35px;
                height: 35px;
                font-size: 0.8rem;
            }
            
            .merchant-cards {
                grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
            }
            
            .warehouse-cards {
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            }
        }
        
        @keyframes rainbowText {
            0% { background-position: 0% 50%; }
            100% { background-position: 100% 50%; }
        }
    </style>
</head>
    <!-- ==================== é®ç½©å’Œç‰¹æ•ˆå±‚ === HTML ç»“æ„éƒ¨åˆ†================= -->
<body>
    <!-- é»‘è‰²é®ç½© -->
    <div id="black-overlay" class="black-overlay"></div>
    
    <!-- æŠ¤æ³•é™ä¸´æ•ˆæœå±‚ -->
    <div id="guardian-arrival" class="guardian-arrival"></div>
    
    <!-- ç¥å…½è§‰é†’ç‰¹æ•ˆ -->
    <div class="evolution-effect" id="evolution-effect">
        <div class="evolution-glow"></div>
    </div>
    
    <div class="container">
        <header>
            <h1>å¹½è¡—å•†äºº</h1>
            <p class="subtitle">ç‡ˆæ˜å··éœ è²¨æš–äººé–’</p>
            <p class="subtitle">å¹½è¡—å•†äººæ¡ŒéŠå°ˆç”¨-æ²‰æµ¸è¼”åŠ©ç¨‹å¼</p>
        </header>
        
<div class="player-setup">
    <div class="input-group">
        <label for="player-name">ç©å®¶åç¨±</label>
        <input type="text" id="player-name" placeholder="è¼¸å…¥ç©å®¶åç¨±" class="elegant-input">
    </div>
    
    <div class="input-group">
        <label for="player-color">é¸æ“‡ä»£è¡¨é¡è‰²</label>
        <div class="color-picker-container">
            <input type="color" id="player-color" value="#3498db">
            <span class="color-preview" id="color-preview"></span>
        </div>
    </div>
    
    <div class="input-group audio-controls">
        <label>éŸ³æ•ˆè¨­å®š</label>
        <div class="audio-buttons">
            <button id="musicToggle" class="btn-audio">
                <span class="audio-icon">ğŸµ</span>
                <span class="audio-text">èƒŒæ™¯éŸ³æ¨‚: é–‹å•Ÿ</span>
            </button>
            <button id="soundToggle" class="btn-audio">
                <span class="audio-icon">ğŸ”Š</span>
                <span class="audio-text">éŸ³æ•ˆ: é–‹å•Ÿ</span>
            </button>
        </div>
    </div>
    
    <div class="action-buttons">
        <button id="add-player" class="btn-primary elegant-btn">æ·»åŠ ç©å®¶</button>
        <button id="reset-game" class="btn-danger elegant-btn">é‡ç½®éŠæˆ²</button>
    </div>
</div>
        
        <!-- èµ°é©¬ç¯åŒºåŸŸ -->
        <div class="marquee-container">
            <div class="marquee-content" id="marquee-text">
                æ­¡è¿ä½¿ç”¨å¹½è¡—å•†äººå°ˆç”¨-æ²‰æµ¸è¼”åŠ©ç¨‹å¼ï¼è«‹æ·»åŠ ç©å®¶æº–å‚™é–‹å§‹äº¤æ˜“å§ã€‚
            </div>
        </div>
        
        <div class="main-content">
            <div class="players-container" id="players-list">
                <!-- ç©å®¶å¡ç‰‡å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
            </div>
            
            <div class="events-container">
                <h2 class="events-title">äº‹ä»¶æ—¥èªŒ</h2>
                <div class="events-list" id="events-list">
                    <div class="event-item">
                        <strong>ç³»çµ±æ¶ˆæ¯!ï¼š</strong> éŠæˆ²é–‹å§‹ï¼æ–°å¢ç©å®¶ä¸¦é–‹å§‹äº¤æ˜“ä¹‹æ—…å§ã€‚
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- å½©ç¥¨é€‰æ‹©æ¨¡æ€æ¡† -->
    <div class="lottery-modal" id="lottery-modal">
        <div class="lottery-content">
            <span class="close-modal" id="close-lottery">&times;</span>
            <h2>é¸æ“‡æ‚¨çš„å¿ƒæ°´å¹¸é‹å½©å·è™Ÿç¢¼</h2>
            <p>è«‹å¾1-50ä¸­é¸æ“‡ä¸€å€‹å½©å·è™Ÿç¢¼ï¼š</p>
            <div class="lottery-numbers" id="lottery-numbers">
                <!-- å·ç å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
            </div>
            <div class="error-message" id="lottery-error"></div>
            <button id="confirm-lottery" class="btn-success">ç¢ºå®šé¸æ“‡</button>
        </div>
    </div>
    
    <!-- å½©ç¥¨å¼€å¥–æ¨¡æ€æ¡† -->
    <div class="lottery-modal" id="draw-modal">
        <div class="lottery-content">
            <h2>å½©ç¥¨é–‹ç - ç¬¬<span id="lottery-round">1</span>æœŸ</h2>
            <p>ç´¯ è¨ˆ ç é‡‘: <span id="jackpot-amount">30</span>éŠ€å…©</p>
            <div class="draw-animation" id="draw-animation">
                <div class="draw-number">?</div>
            </div>
            <div class="winner-display" id="winner-display">
                <!-- ä¸­å¥–ä¿¡æ¯å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
            </div>
            <button id="close-draw" class="btn-primary">-é—œé–‰-</button>
        </div>
    </div>
    
    <!-- ç«çŒœç¯èŠ‚æ¨¡æ€æ¡† -->
    <div class="guess-modal" id="guess-modal">
        <div class="guess-content">
            <span class="close-modal" id="close-guess">&times;</span>
            <h2>-å¯¶ç®±éŠ€å…©-ç«¶çŒœç’°ç¯€</h2>
            <p>äº¤æ˜“æ¬¡æ•¸å·²é”ç«¶çŒœæ¢ä»¶ï¼è§¸ç™¼å¯¶ç®±ç«¶çŒœ!</p>
            <div class="event-item event-global">
                <strong>ç«¶çŒœæç¤ºï¼š</strong> ç°åœ¨ï¼å„ä½å•†äººä»¬è«‹äº’ç›¸å–å‡ºä¸€å®šé‡çš„éŠ€å…©,
                åœ¨æ¡Œä¸Šæ‹³é ­æ¡ç·Š,ç„¶å¾Œé€²è¡ŒçŒœæ¸¬å°æ–¹çš„éŠ€å…©æ•¸ç›®ï¼ï¼(éŠ€å…©æ•¸é‡åªèƒ½æ•´æ•¸10,30,50...)
            </div>
            <button id="close-guess-btn" class="btn-primary">-é—œé–‰-</button>
        </div>
    </div>
    
    <!-- ç¥ç§˜å•†äººæ¨¡æ€æ¡† -->
    <div class="merchant-modal" id="merchant-modal">
        <div class="merchant-content">
            <span class="close-modal" id="close-merchant">&times;</span>
            <h2>ç¥ç§˜å•†äºº</h2>
            <p>ä½ ...é‡åˆ°äº†å¾å¤©è€Œé™çš„ç¥ç§˜å•†äººï¼ç¾åœ¨å¯ä»¥ç”¨éŠ€å…©,è²¨ç‰©,æ‰‹ç‰Œäº¤æ›ç‰¹æ®Šå¡ç‰‡</p>
            <div class="merchant-cards" id="merchant-cards">
                <!-- å¡ç‰‡å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
            </div>
            <div class="error-message" id="merchant-error"></div>
            <button id="confirm-purchase" class="btn-success">ç¢ºå®šè³¼è²·</button>
        </div>
    </div>
    
    <!-- ä»“åº“æ¨¡æ€æ¡† -->
    <div class="warehouse-modal" id="warehouse-modal">
        <div class="warehouse-content">
            <span class="close-modal" id="close-warehouse">&times;</span>
            <h2>å¹½è¡—è²¨ç‰©å€‰åº«</h2>
            <p>æ‚¨ç²å¾—çš„å¹½è¡—è²¨ç‰©äº¤æ˜“å¡</p>
            <div class="warehouse-cards" id="warehouse-cards">
                <!-- å¹½è¡—è´§å¡å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
            </div>
            <div class="error-message" id="warehouse-error"></div>
            <button id="use-goods-card" class="btn-success">ä½¿ç”¨é¸ä¸­çš„è²¨å¡</button>
            <button id="close-warehouse-btn" class="btn-primary">é—œé–‰å€‰åº«</button>
        </div>
    </div>
    
    <!-- ä½¿ç”¨å¡ç‰‡ç¡®è®¤æ¨¡æ€æ¡† -->
    <div class="lottery-modal" id="use-card-modal">
        <div class="lottery-content">
            <h2>ä½¿ç”¨å¡ç‰‡</h2>
            <p id="use-card-desc">ç¢ºå®šè¦ä½¿ç”¨é€™å¼µå¡ç‰‡å—ï¼Ÿè«‹çµ¦äºˆå…¶ä»–å•†äººæŸ¥çœ‹å¡ç‰‡å…§å®¹æ–¹ä¾¿åŸ·è¡Œï¼</p>
            <div class="error-message" id="use-card-error"></div>
            <button id="confirm-use-card" class="btn-success">ç¢ºå®šä½¿ç”¨å—?</button>
            <button id="cancel-use-card" class="btn-danger">-å–æ¶ˆ-</button>
        </div>
    </div>
    
    <!-- é€²åŒ–ç¢ºèªæ¨¡æ…‹æ¡† -->
    <div class="evolution-modal" id="evolution-modal">
        <div class="evolution-content">
            <span class="close-modal" id="close-evolution">&times;</span>
            <h2>è­·æ³•ç¥ç¸è¦ºé†’</h2>
            <p id="evolution-desc">ç¢ºå®šè¦é€²åŒ–æ‚¨çš„è­·æ³•ç¥ç¸å—ï¼Ÿ</p>
            
            <div class="evolution-info">
                <div class="evolution-cost">
                    <h3>é€²åŒ–æ¶ˆè€—</h3>
                    <div id="evolution-cost-list">
                        <!-- æ¶ˆè€—ææ–™å°‡åœ¨é€™è£¡å‹•æ…‹ç”Ÿæˆ -->
                    </div>
                </div>
                
                <div class="evolution-benefits">
                    <h3>é€²åŒ–æ•ˆæœ</h3>
                    <div id="evolution-benefits-list">
                        <!-- é€²åŒ–å¥½è™•å°‡åœ¨é€™è£¡å‹•æ…‹ç”Ÿæˆ -->
                    </div>
                </div>
            </div>
            
            <div class="error-message" id="evolution-error"></div>
            <button id="confirm-evolution" class="btn-success">ç¢ºèªé€²åŒ–</button>
            <button id="cancel-evolution" class="btn-danger">å–æ¶ˆ</button>
        </div>
    </div>
    
    <!-- éš¾åº¦é€‰æ‹©æŒ‰é’® -->
    <div class="difficulty-toggle" id="difficulty-toggle">
        <span class="easy active" data-difficulty="easy">ç°¡</span>
        <span class="hard" data-difficulty="hard">é›£</span>
    </div>
    
    <!-- Footerï¼ˆç‹¬ç«‹äºåç§»å®¹å™¨ï¼‰ -->
    <footer>
        <p>Â© 2025 å¹½è¡—å•†äººæ¡ŒéŠ-æ²‰æµ¸è¼”åŠ©ç¨‹åº- ç‚ºæ‚¨çš„æ¡ŒéŠé«”é©—å¢æ·»æ¨‚è¶£ v2.0</p>
    </footer>
        <!-- ==================== éŸ³é¢‘å…ƒç´  ==Audioéƒ¨åˆ† ================== -->
    <!-- éŸ³é¢‘å…ƒç´  -->
    <audio id="tradeSound">
        <source src="https://www.soundjay.com/misc/sounds/coins-to-table-2.mp3" type="audio/mpeg">
    </audio>
    <audio id="buttonSound">
        <source src="https://www.soundjay.com/buttons/sounds/button-30.mp3" type="audio/mpeg">
    </audio>
    <audio id="bullSound">
        <source src="https://www.soundjay.com/nature/sounds/lake-waves-lapping-gently-against-rocks-01.mp3" type="audio/mpeg">
    </audio>
    <audio id="tigerSound">
        <source src="https://www.soundjay.com/nature/sounds/wind-howl-01.mp3" type="audio/mpeg">
    </audio>
    <audio id="dragonSound">
        <source src="https://www.soundjay.com/nature/sounds/rain-03.mp3" type="audio/mpeg">
    </audio>
    <audio id="phoenixSound">
         <source src="sounds/background.mp3" type="audio/mpeg">
    </audio>
    <audio id="turtleSound">
        <source src="https://www.soundjay.com/nature/sounds/lake-waves-lapping-gently-on-the-beach-01.mp3" type="audio/mpeg">
    </audio>
    <audio id="lotterySound">
        <source src="https://www.soundjay.com/misc/sounds/magic-chime-04.mp3" type="audio/mpeg">
    </audio>
    <audio id="cardUseSound">
        <source src="https://www.soundjay.com/misc/sounds/shuffling-cards-1.mp3" type="audio/mpeg">
    </audio>
    <audio id="bgMusic" loop>
        <source src=""sounds/background.mp3" type="audio/mpeg">" type="audio/mpeg">
    </audio>
    <audio id="getGoodsSound">
        <source src="https://www.soundjay.com/misc/sounds/magic-chime-02.mp3" type="audio/mpeg">
    </audio>
    <audio id="lotteryWinSound">
        <source src="https://www.soundjay.com/misc/sounds/coins-drop-1.mp3" type="audio/mpeg">
    </audio>
    <audio id="selectCardSound">
        <source src="https://www.soundjay.com/buttons/sounds/button-35.mp3" type="audio/mpeg">
    </audio>
    <audio id="merchantAppearSound">
        <source src="https://www.soundjay.com/misc/sounds/wind-chime-1.mp3" type="audio/mpeg">
    </audio>
    <audio id="warehouseOpenSound">
        <source src="https://www.soundjay.com/misc/sounds/magic-chime-07.mp3" type="audio/mpeg">
    </audio>
    <audio id="evolutionSound">
        <source src="https://www.soundjay.com/misc/sounds/magic-chime-03.mp3" type="audio/mpeg">
    </audio>
	<audio id="evolutionBgMusic">
  <source src="https://example.com/evolution-bg-music.mp3" type="audio/mpeg">
</audio>

    <script>
	    /* ==================== JavaScript æ¸¸æˆé€»è¾‘ æ¸¸æˆé€»è¾‘ä»£ç ==================== */
        document.addEventListener('DOMContentLoaded', function() {
            // è·å–DOMå…ƒç´ 
            const playerNameInput = document.getElementById('player-name');
            const playerColorInput = document.getElementById('player-color');
            const addPlayerBtn = document.getElementById('add-player');
            const resetGameBtn = document.getElementById('reset-game');
            const playersList = document.getElementById('players-list');
            const eventsList = document.getElementById('events-list');
            const lotteryModal = document.getElementById('lottery-modal');
            const lotteryNumbers = document.getElementById('lottery-numbers');
            const confirmLotteryBtn = document.getElementById('confirm-lottery');
            const closeLotteryBtn = document.getElementById('close-lottery');
            const lotteryError = document.getElementById('lottery-error');
            const drawModal = document.getElementById('draw-modal');
            const drawAnimation = document.getElementById('draw-animation');
            const winnerDisplay = document.getElementById('winner-display');
            const closeDrawBtn = document.getElementById('close-draw');
            const guessModal = document.getElementById('guess-modal');
            const closeGuessBtn = document.getElementById('close-guess');
            const closeGuessBtn2 = document.getElementById('close-guess-btn');
            const marqueeText = document.getElementById('marquee-text');
            const lotteryRoundEl = document.getElementById('lottery-round');
            const jackpotAmountEl = document.getElementById('jackpot-amount');
			

            
            // éŸ³æ•ˆæ§åˆ¶
            let soundEnabled = true;
            let musicEnabled = true;
            const bgMusic = document.getElementById('bgMusic');
            const musicToggle = document.getElementById('musicToggle');
            const soundToggle = document.getElementById('soundToggle');
            
            // èƒŒæ™¯éŸ³ä¹æ§åˆ¶
            musicToggle.addEventListener('click', function() {
                musicEnabled = !musicEnabled;
                if (musicEnabled) {
                    bgMusic.play();
                    this.textContent = 'èƒŒæ™¯éŸ³æ¨‚: é–‹å•Ÿ';
                } else {
                    bgMusic.pause();
                    this.textContent = 'èƒŒæ™¯éŸ³æ¨‚: é—œé–‰';
                }
            });
            
            // éŸ³æ•ˆæ§åˆ¶
            soundToggle.addEventListener('click', function() {
                soundEnabled = !soundEnabled;
                this.textContent = soundEnabled ? 'éŸ³æ•ˆ: é–‹å•Ÿ' : 'éŸ³æ•ˆ: é—œé–‰';
            });
            
            // æ’­æ”¾éŸ³æ•ˆçš„å‡½æ•°
            function playSound(soundId) {
                if (!soundEnabled) return;
                
                const sound = document.getElementById(soundId);
                if (sound) {
                    sound.currentTime = 0;
                    sound.play().catch(e => console.log("éŸ³æ•ˆæ’­æ”¾å¤±è´¥:", e));
                }
            }
            
            // è‡ªåŠ¨æ’­æ”¾èƒŒæ™¯éŸ³ä¹ï¼ˆéœ€è¦ç”¨æˆ·äº¤äº’åï¼‰
            document.addEventListener('click', function initMusic() {
                if (musicEnabled) {
                    bgMusic.play().catch(e => console.log("èƒŒæ™¯éŸ³ä¹æ’­æ”¾å¤±è´¥:", e));
                }
                document.removeEventListener('click', initMusic);
            }, { once: true });
            
            // ä¸ºæ‰€æœ‰æŒ‰é’®æ·»åŠ ç‚¹å‡»éŸ³æ•ˆ
            document.addEventListener('click', function(e) {
                if (e.target.tagName === 'BUTTON' && soundEnabled) {
                    playSound('buttonSound');
                }
            });
            
            // ç¥ç§˜å•†äººç›¸å…³å…ƒç´ 
            const merchantModal = document.getElementById('merchant-modal');
            const merchantCardsEl = document.getElementById('merchant-cards');
            const confirmPurchaseBtn = document.getElementById('confirm-purchase');
            const closeMerchantBtn = document.getElementById('close-merchant');
            const merchantError = document.getElementById('merchant-error');
            
            // ä»“åº“ç›¸å…³å…ƒç´ 
            const warehouseModal = document.getElementById('warehouse-modal');
            const warehouseCardsEl = document.getElementById('warehouse-cards');
            const useGoodsCardBtn = document.getElementById('use-goods-card');
            const closeWarehouseBtn = document.getElementById('close-warehouse');
            const closeWarehouseBtn2 = document.getElementById('close-warehouse-btn');
            const warehouseError = document.getElementById('warehouse-error');
            
            // ä½¿ç”¨å¡ç‰‡ç›¸å…³å…ƒç´ 
            const useCardModal = document.getElementById('use-card-modal');
            const useCardDesc = document.getElementById('use-card-desc');
            const confirmUseCardBtn = document.getElementById('confirm-use-card');
            const cancelUseCardBtn = document.getElementById('cancel-use-card');
            const useCardError = document.getElementById('use-card-error');
            
            // è¿›åŒ–ç›¸å…³å…ƒç´ 
            const evolutionModal = document.getElementById('evolution-modal');
            const evolutionDesc = document.getElementById('evolution-desc');
            const evolutionCostList = document.getElementById('evolution-cost-list');
            const evolutionBenefitsList = document.getElementById('evolution-benefits-list');
            const evolutionError = document.getElementById('evolution-error');
            const confirmEvolutionBtn = document.getElementById('confirm-evolution');
            const cancelEvolutionBtn = document.getElementById('cancel-evolution');
            const closeEvolutionBtn = document.getElementById('close-evolution');
            
            // æ¸¸æˆæ•°æ®
            let players = JSON.parse(localStorage.getItem('players')) || [];
            let events = JSON.parse(localStorage.getItem('events')) || [];
            let currentPlayerForLottery = null;
            let totalTrades = parseInt(localStorage.getItem('totalTrades')) || 0;
            let jackpot = parseInt(localStorage.getItem('jackpot')) || 10;
            let lotteryRound = parseInt(localStorage.getItem('lotteryRound')) || 1;
            let selectedNumbers = JSON.parse(localStorage.getItem('selectedNumbers')) || [];
            
            // å½“å‰é€‰ä¸­çš„ç©å®¶å’Œå¡ç‰‡
            let currentPlayerForMerchant = null;
            let currentPlayerForWarehouse = null;
            let selectedCardId = null;
            let selectedGoodsCardId = null;
            let currentCardToUse = null;
            let currentCardPlayerIndex = null;
            let currentEvolutionPlayerIndex = null;
            
            // èµ°é©¬ç¯æ§åˆ¶å˜é‡
            let isPriorityMessage = false;
            let normalMarqueeQueue = [];
            let priorityMarqueeQueue = [];
            
            // å½©è‰²å·ç çƒé¢œè‰²
            const numberColors = [
                '#e74c3c', '#e67e22', '#f1c40f', '#2ecc71', 
                '#3498db', '#9b59b6', '#1abc9c', '#d35400',
                '#c0392b', '#16a085', '#27ae60', '#2980b9',
                '#8e44ad', '#2c3e50', '#f39c12', '#e74c3c',
                '#d35400', '#c0392b', '#bdc3c7', '#7f8c8d',
                '#34495e', '#f39c12', '#e67e22', '#d35400',
                '#c0392b', '#8e44ad', '#9b59b6', '#2980b9',
                '#3498db', '#1abc9c', '#16a085', '#27ae60',
                '#2ecc71', '#f1c40f', '#e67e22', '#e74c3c',
                '#d35400', '#c0392b', '#8e44ad', '#9b59b6',
                '#2980b9', '#3498db', '#1abc9c', '#16a085',
                '#27ae60', '#2ecc71', '#f1c40f', '#e67e22',
                '#e74c3c', '#d35400'
            ];
            
            // è´§ç‰©ç±»å‹
            const goodsTypes = [
                { name: "ç•ªè´§", color: "goods-fanhuo", value: 15 },
                { name: "æ–‡ç©", color: "goods-wenwan", value: 25 },
                { name: "å¼‚å…½", color: "goods-yishou", value: 35 },
                { name: "ç›é“", color: "goods-yantie", value: 20 },
                { name: "ç«å™¨", color: "goods-huoqi", value: 40 },
                { name: "å¥‡ç‰©", color: "goods-qiwu", value: 30 }
            ];
            
            // ç¯å¢ƒäº‹ä»¶åº“
            const environmentEvents = [
                // å…¨å±€äº‹ä»¶
                { 
                    type: 'global', 
                    shortText: "-å…¨é«”-æ²™æ¼ é¢¨æš´è¥²æ“Šï¼æ‰€æœ‰å•†äººå—å½±éŸ¿-10å…©éŠ€ã€‚",
                    fullText: "æ²™æ¼ é¢¨æš´è¥²æ“Šï¼æ¼«å¤©é»ƒæ²™ä¸­ï¼Œæ‰€æœ‰å•†éšŠéƒ½å—åˆ°äº†å½±éŸ¿ã€‚å•†æœƒè¦æ±‚æ¯ä½å•†äººæè´ˆ10å…©éŠ€å­ç”¨æ–¼æ•‘ç½å’Œé“è·¯ä¿®å¾©ã€‚",
                    effect: "all-10" 
                },
                { 
                    type: 'global', 
                    shortText: "-å…¨é«”-å•†èˆ¹é­é‡é¢¨æš´ï¼Œ1å€‹è²¨ç‰©æå¤±-å¦‚æœæ²’æœ‰è²¨ç‰©ï¼Œéœ€å‘å•†æœƒç¹³3å…©éŠ€å­è£œå„Ÿæã€‚",
                    fullText: "æµ·ä¸Šçªç„¶åˆ®èµ·çŒ›çƒˆé¢¨æš´ï¼Œä½ å€‘çš„å•†èˆ¹åœ¨æ³¢æ¿¤ä¸­è‰±é›£å‰è¡Œï¼Œéƒ¨åˆ†è²¨ç‰©æ‰è½æµ·ä¸­ã€‚å¦‚æœæ²’æœ‰è²¨ç‰©ï¼Œéœ€å‘å•†æœƒç¹³3å…©éŠ€å­è£œå„Ÿæå¤±ã€‚",
                    effect: "allCargo-3" 
                },
                { 
                    type: 'global', 
                    shortText: "-å…¨é«”-è²¿æ˜“ç¹æ¦®ï¼å¸‚å ´æ´»èº-æ¯äººå¾ç‰Œå †æŠ½å–ä¸€å¼µè²¨å¡",
                    fullText: "è¿‘æœŸè²¿æ˜“ç¹æ¦®ï¼å¸‚å ´ç•°å¸¸æ´»èºï¼Œæ‰€æœ‰å•†äººéƒ½ç²å¾—äº†æ›´å¤šçš„äº¤æ˜“æ©Ÿæœƒå’Œåˆ©æ½¤-æ¯äººå¾ç‰Œå †æŠ½å–ä¸€å¼µè²¨å¡ã€‚",
                    effect: "all+5" 
                },
                { 
                    type: 'global', 
                    shortText: "-å…¨é«”-ç¨…é‡‘å¢åŠ ï¼Œå•†æœƒè¦æ±‚ç¹³äº¤é¡å¤–è²»ç”¨-10å…©éŠ€å­",
                    fullText: "åœ°æ–¹æ”¿åºœå¢åŠ äº†å•†æ¥­ç¨…æ”¶ï¼Œå•†æœƒå¿…é ˆå‘æ‰€æœ‰æˆå“¡å¾µæ”¶é¡å¤–è²»ç”¨ï¼Œæ¯äºº10å…©éŠ€å­ã€‚",
                    effect: "all-8" 
                },
                
                // ä¸ªä½“äº‹ä»¶
                { 
                    type: 'individual', 
                    shortText: "-å€‹äºº-è²·åˆ°å‡è²¨ï¼Œæå¤±éŒ¢è²¡ å€‹äºº-20éŠ€å…©",
                    fullText: "ä¸€å€‹çœ‹ä¼¼èª å¯¦çš„ç•°é„‰å•†äººå‘ä½ è³£äº†ä¸€æ‰¹è²¨ç‰©ï¼Œå¾Œä¾†ç™¼ç¾å…¨æ˜¯å‡è²¨ï¼æå¤±20å…©éŠ€å­ï¼Œä¸¦éœ€å‘å•†æœƒæäº¤ä¸€ä»¶å•†å“ä½œç‚ºè­¦ç¤ºã€‚",
                    effect: "-10" 
                },
                { 
                    type: 'individual', 
                    shortText: "-å€‹äºº-æˆåŠŸè«‡åˆ¤ï¼Œç²å¾—é¡å¤–åˆ©æ½¤+20éŠ€å…©",
                    fullText: "ä½ é‹ç”¨ç²¾æ˜çš„è«‡åˆ¤æŠ€å·§ï¼ŒæˆåŠŸèˆ‡ä¾›æ‡‰å•†é”æˆå„ªæƒ å”è­°ï¼Œç²å¾—äº†é¡å¤–åˆ©æ½¤ +20éŠ€å…©ã€‚",
                    effect: "+15" 
                },
                { 
                    type: 'individual', 
                    shortText: "-å€‹äºº-æŠ•è³‡æˆåŠŸï¼Œå›å ±è±åš+30éŠ€å…©",
                    fullText: "ä½ ä¹‹å‰çš„ä¸€é …æŠ•è³‡ç²å¾—äº†è±åšå›å ±ï¼Œè²¡å¯Œå¢åŠ äº†30å…©éŠ€å­ã€‚",
                    effect: "+20" 
                },
                
                // ç‰¹åˆ«äº‹ä»¶ - å¹½è¡—è´§å¡
                { 
                    type: 'special', 
                    shortText: "-ç‰¹åˆ¥-é‡åˆ°ç¥ç§˜å®¢äººï¼Œç²å¾—å¹½è¡—è²¨ç‰©äº¤æ˜“å¡ï¼",
                    fullText: "åœ¨å¹½è¡—çš„è½‰è§’è™•ï¼Œä½ é‡åˆ°äº†ä¸€ä½ç¥ç§˜çš„å®¢äººï¼Œä»–è´ˆäºˆä½ å¹½è¡—è²¨ç‰©äº¤æ˜“å¡ï¼Œå¯ä»¥åœ¨å€‰åº«ä¸­æŸ¥çœ‹å’Œä½¿ç”¨é€™äº›ç‰¹æ®Šè²¨ç‰©ï¼",
                    effect: "getGoodsCards" 
                },
                { 
                    type: 'special', 
                    shortText: "-å…¨é«”ç‰¹åˆ¥-ç¥ç§˜å•†éšŠä¾†è¨ªï¼Œæ‰€æœ‰äººç²å¾—å¹½è¡—è²¨ç‰©äº¤æ˜“å¡ï¼",
                    fullText: "ä¸€æ”¯ç¥ç§˜çš„å•†éšŠä¾†åˆ°å¹½è¡—ï¼Œä»–å€‘è´ˆäºˆæ‰€æœ‰å•†äººå¹½è¡—è²¨ç‰©äº¤æ˜“å¡ï¼Œå¯ä»¥åœ¨å€‰åº«ä¸­æŸ¥çœ‹å’Œä½¿ç”¨é€™äº›ç‰¹æ®Šè²¨ç‰©ï¼",
                    effect: "allGetGoodsCards" 
                }
            ];

            // å¹½è¡—è´§å¡åº“
            const goodsCardLibrary = [
                // å¹½é­‚çº§åˆ« (1-2ä¸ªè´§ç‰©)
                { id: 101, name: "å¹½é­‚è²¨å¡", rarity: "ghost", goodsCount: 1, buyPrice: 20, sellPrice: 30 },
                { id: 102, name: "å¹½é­‚è²¨å¡", rarity: "ghost", goodsCount: 2, buyPrice: 35, sellPrice: 50 },
                
                // å¦–ç²¾çº§åˆ« (3-4ä¸ªè´§ç‰©)
                { id: 201, name: "å¦–ç²¾è²¨å¡", rarity: "fairy", goodsCount: 3, buyPrice: 55, sellPrice: 75 },
                { id: 202, name: "å¦–ç²¾è²¨å¡", rarity: "fairy", goodsCount: 4, buyPrice: 70, sellPrice: 95 },
                
                // å¤§ç‹çº§åˆ« (5-6ä¸ªè´§ç‰©)
                { id: 301, name: "å¤§ç‹è²¨å¡", rarity: "king", goodsCount: 5, buyPrice: 200, sellPrice: 260 },
                { id: 302, name: "å¤§ç‹è²¨å¡", rarity: "king", goodsCount: 6, buyPrice: 240, sellPrice: 320 }
            ];

            // ç¥ç§˜å•†äººå¡ç‰‡åº«
            const merchantCardLibrary = [
                { id: 1, name: "é›™å€äº¤æ˜“", cost: 1, description: "ä¸‹æ¬¡è³£è²¨äº¤æ˜“ç²å¾—é›™å€æ”¶ç›Š,ä¸æ˜¯æ•´å€‹å›åˆ", effect: "doubleNextTrade", rarity: "normal" },
                { id: 2, name: "å°é¡å€Ÿè²¸", cost: 1, description: "ç«‹å³ç²å¾—100å…©éŠ€å­ï¼Œä½†æ¯å€‹å›åˆéœ€æ­¸è®“20éŠ€å­æŒçºŒ5å›åˆ", effect: "smallLoan", rarity: "normal" },
                { id: 3, name: "å¹¸é‹éª°å­", cost: 1, description: "ä¸‹æ¬¡äº¤æ˜“é¡å¤–ç²å¾—,ç²å¾—ä¸‹ä¸€æ¬¡å½©å·æŠ½å‡ºçš„è™Ÿç¢¼ä½œç‚ºçé‡‘", effect: "luckyDice", rarity: "normal" },
                { id: 4, name: "å¿«é€Ÿäº¤æ˜“", cost: 1, description: "ç«‹å³å®Œæˆä¸€æ¬¡äº¤æ˜“ï¼Œç„¡éœ€ç­‰å¾…", effect: "quickTrade", rarity: "normal" },
                { id: 5, name: "å¸‚å ´æ´å¯Ÿ", cost: 2, description: "æŸ¥çœ‹ä¸‹ä¸€å¼µç’°å¢ƒäº‹ä»¶å¡", effect: "peekNextEvent", rarity: "magic" },
                { id: 6, name: "ä¸­åº¦é˜²è­·", cost: 2, description: "æŠµæ¶ˆä¸‹ä¸€æ¬¡è² é¢äº‹ä»¶", effect: "reduceNextNegative", rarity: "magic" },
                { id: 7, name: "è²¨ç‰©ä¿éšª", cost: 2, description: "é˜²æ­¢ä¸‹ä¸€æ¬¡è²¨ç‰©æå¤±", effect: "cargoInsurance", rarity: "magic" },
                { id: 8, name: "åƒ¹æ ¼é æ¸¬", cost: 2, description: "é çŸ¥ä¸‹ä¸€æ¬¡äº¤æ˜“çš„åƒ¹æ ¼æ³¢å‹•å¾æ£„ç‰Œå †é¸æ“‡ä¸€å¼µè²¨ç‰©å¡", effect: "pricePrediction", rarity: "magic" },
                { id: 9, name: "è²¡å¯Œç«Šå–", cost: 4, description: "éš¨æ©Ÿå¾ä¸€åç©å®¶ç«Šå–20å…©éŠ€å­", effect: "stealWealth", rarity: "rare" },
                { id: 10, name: "å¹¸é‹æ—¥", cost: 4, description: "ç«‹å³ç²å¾—40å…©éŠ€å­", effect: "instantWealth", rarity: "rare" },
                { id: 11, name: "è²¿æ˜“å£Ÿæ–·", cost: 4, description: "ç¨ä½”ä¸‹ä¸€æ¬¡äº¤æ˜“çš„æ‰€æœ‰åˆ©æ½¤", effect: "tradeMonopoly", rarity: "rare" },
                { id: 12, name: "å•†éšŠè­·è¡›", cost: 4, description: "é˜²æ­¢ä¸‹ä¸€æ¬¡æ¶åŠ«äº‹ä»¶", effect: "caravanGuard", rarity: "rare" },
                { id: 13, name: "è²¿æ˜“ä¿è­·", cost: 6, description: "å…ç–«ä¸‹ä¸€æ¬¡è² é¢äº‹ä»¶", effect: "immuneNextNegative", rarity: "epic" },
                { id: 14, name: "ç²¾æº–æŠ•è³‡", cost: 6, description: "ä¸‹ä¸‰æ¬¡äº¤æ˜“é¡å¤–ç²å¾—10å…©éŠ€å­", effect: "investmentBonus", rarity: "epic" },
                { id: 15, name: "å½©ç¥¨é æ¸¬", cost: 6, description: "æå‰çŸ¥é“ä¸‹ä¸€æœŸå½©ç¥¨ä¸­çè™Ÿç¢¼,ä½¿ç”¨å¡ç‰‡å¾Œå¯ä»¥é€£çºŒæŒ‰ä¸‰æ¬¡äº¤æ˜“æˆåŠŸæŒ‰éˆ•åŠé¸æ“‡è™Ÿç¢¼", effect: "predictLottery", rarity: "epic" },
                { id: 16, name: "å¸‚å ´æ“æ§", cost: 6, description: "å¾ç‰Œå †æŠ½å–äº”å¼µå¡æ”¾åˆ°è‡ªå·±æ‰‹ç‰Œ", effect: "marketManipulation", rarity: "epic" },
                { id: 17, name: "å¼·åˆ¶äº¤æ˜“", cost: 8, description: "å¼·åˆ¶èˆ‡ä¸€åç©å®¶é€²è¡Œäº¤æ˜“ï¼Œç²å¾—å…¶50å…©éŠ€å­/å°æ‰‹3æ‰‹ç‰Œ/3å€‹è²¨ç‰©", effect: "forceTrade", rarity: "legendary" },
                { id: 18, name: "äº‹ä»¶æ“æ§", cost: 8, description: "é¸æ“‡ä¸‹ä¸€è¼ªç™¼ç”Ÿçš„äº‹ä»¶é¡å‹,å¾ç‰Œå †æŠ½å–5å¼µæ”¾åˆ°è‡ªå·±æ‰‹ç‰Œ", effect: "controlEvent", rarity: "legendary" },
                { id: 19, name: "æ™‚é–“å›æº¯", cost: 8, description: "æ’¤éŠ·ä¸Šä¸€æ¬¡äº¤æ˜“æˆ–äº‹ä»¶çš„å½±éŸ¿", effect: "timeReverse", rarity: "legendary" },
                { id: 20, name: "è²¡å¯Œè½‰ç§»", cost: 8, description: "å°‡è‡ªå·±çš„è²¡å¯Œè½‰ç§»çµ¦å…¶ä»–ç©å®¶", effect: "wealthTransfer", rarity: "legendary" },
                { id: 201, name: "ç‰›ç¥è­·æ³•", cost: 12, description: "ã€Œè½Ÿ â€”â€”ï¼åœ°è„ˆéœ‡å‹•é–“ï¼Œé‡‘è§’ç‰›ç¥è¸ç¢å²©å±¤ç™»å ´ï¼ç²—å£¯ç‰›è§’é ‚å‘å°æ‰‹ï¼", effect: "bullGuardian", rarity: "legendary" },
                { id: 202, name: "ç™½è™è­·æ³•", cost: 12, description: "ã€Œå—·å—š â€”â€”ï¼è’¼ç™½é¢¶é¢¨æ’•ç¢æˆ°å ´é›²å±¤ï¼Œç™½è™è­·æ³•å››çˆªè¸é¢¨ç¾èº«ï¼ŒéŠ€ç™½çš®æ¯›é–“é›»å¼§å™¼å•ªä½œéŸ¿ï¼", effect: "tigerGuardian", rarity: "legendary" },
                { id: 203, name: "é’é¾è­·æ³•", cost: 12, description: "ã€Œå˜¯ â€”â€”ï¼é’é›²ç¿»æ¹§é–“ï¼Œé’é¾å·¨è»€ç ´éœ„è€Œä¸‹ï¼Œæ•¸åä¸ˆé¾èº«çºç¹é›·éœ†ï¼Œé¾é±—åœ¨å¤©å…‰ä¸‹æ³›ç€å†·å†½é’å…‰ï¼", effect: "dragonGuardian", rarity: "legendary" },
                { id: 204, name: "æœ±é›€è­·æ³•", cost: 12, description: "ã€Œè½Ÿéš†ï¼ç«å±±è£‚ç¸«å™´æ¶Œèµ¤ç´…å²©æ¼¿ï¼Œæœ±é›€è­·æ³•å±•é–‹ä¸ˆé¤˜ç«ç¿¼ï¼Œç«ç„°ç¾½æ¯›è½è™•çš†åŒ–ç„¦åœŸï¼", effect: "phoenixGuardian", rarity: "legendary" },
                { id: 205, name: "ç„æ­¦è­·æ³•", cost: 12, description: "ã€Œå’šï¼å’šï¼åšé‡é¾œç”²ç ¸å¾—æˆ°å ´åœ°é¢å´©è£‚ï¼Œç„æ­¦è­·æ³•å¾æ·±æµ·æ¹§ç¾ï¼Œå‘¨èº«çºç¹æ»”å¤©æ°´éœ§ï¼Œè›‡é¦–èˆ‡é¾œé ­ä¸¦åˆ—æšèµ·ï¼", effect: "turtleGuardian", rarity: "legendary" },
                { id: 21, name: "å•†äººç¥ç¦", cost: 10, description: "ç«‹å³ç²å¾—80å…©éŠ€å­", effect: "permanentBonus", rarity: "divine" },
                { id: 22, name: "é»çŸ³æˆé‡‘", cost: 10, description: "å°‡ä¸€ä»¶è²¨ç‰©è½‰åŒ–ç‚º100å…©éŠ€å­è²¨ç‰©å›åˆ°å•†æœƒ", effect: "alchemy", rarity: "divine" },
                { id: 23, name: "å•†æœƒç‰¹æ¬Š", cost: 10, description: "ç²å¾—å•†æœƒç‰¹æ®Šå¾…é‡ï¼Œé€£çºŒä¸‰å›åˆå¾—åˆ°å¤šä¸‰å€‹è¡Œå‹•é»", effect: "taxExemption", rarity: "divine" },
                { id: 24, name: "æ²™æ¼ ä¹‹èˆŸ", cost: 10, description: "å…ç–«æ‰€æœ‰ç’°å¢ƒè² é¢äº‹ä»¶ï¼ŒæŒçºŒäº”è¼ªåŠå¾ç‰ŒåŸ‹æŠ½å‡º10å¼µå¡æ”¾å›æ‰‹ç‰Œ", effect: "desertShip", rarity: "divine" },
                { id: 25, name: "å¤©ç©ºä¹‹çœ¼", cost: 10, description: "ç„¡éœ€è²¨å¡è³‡æº,ç›´æ¥å‘å•†æœƒäº¤æ˜“è³£å‡ºè²¨ç‰©,è²¨ç‰©å‡ºå”®åƒ¹ä¹˜5", effect: "skyEye", rarity: "divine" },
            ];
            
						        // æ–°å¢ï¼šæŠ¤æ³•è¿›åŒ–å›¾ç‰‡æ˜ å°„
        const evolvedGuardianImages = {
            'bull': 'https://imgur.com/Ph8b0iC.jpg',
            'dragon': 'https://imgur.com/u78PMgP.jpg',
            'tiger': 'https://imgur.com/COJnCXH.jpg',
            'phoenix': 'https://imgur.com/Tt7n0gC.jpg',
			'turtle': 'https://imgur.com/9Ize9WC.jpg',
        };
            // è­·æ³•é€²åŒ–æ•¸æ“š
            const guardianEvolutionData = {
                "ç‰›ç¥è­·æ³•": {
                    cost: [{ type: "wealth", amount: 100 }, { type: "cards", amount: 3 }],
                    benefits: ["æ¯æ¬¡äº¤æ˜“é¡å¤–ç²å¾—100éŠ€å…©", "å…ç–«åƒ¹æ ¼æ³¢å‹•äº‹ä»¶"],
                    evolvedEffect: { extraWealthPerTrade: 100, immuneToMarketEvents: true },
                    sound: "bullSound",
                    image: "https://imgur.com/fKa3ebt.jpg"
                },
                "ç™½è™è­·æ³•": {
                    cost: [{ type: "wealth", amount: 100 }, { type: "cards", amount: 3 }],
                    benefits: ["æ¯æ¬¡å¾ç‰Œå †æŠ½å–3å¼µå¡", "å¯ä»¥çœ‹åˆ°å°æ‰‹çš„æ‰‹ç‰Œ"],
                    evolvedEffect: { extraCardsPerDraw: 3, seeOpponentHand: true },
                    sound: "tigerSound",
                    image: "https://imgur.com/COJnCXH.jpg"
                },
                "é’é¾è­·æ³•": {
                    cost: [{ type: "wealth", amount: 100 }, { type: "cards", amount: 3 }],
                    benefits: ["å®Œå…¨å…ç–«æ‰€æœ‰è² é¢äº‹ä»¶", "æ¯å›åˆè‡ªå‹•ç²å¾—50éŠ€å…©"],
                    evolvedEffect: { immuneToAllNegative: true, autoWealthPerTurn: 50 },
                    sound: "dragonSound",
                    image: "https://imgur.com/iDs3ZIS.jpg"
                },
                "æœ±é›€è­·æ³•": {
                    cost: [{ type: "wealth", amount: 100 }, { type: "cards", amount: 3 }],
                    benefits: ["æ¯å›åˆå¾æ‰€æœ‰å°æ‰‹ç«Šå–50éŠ€å…©", "äº¤æ˜“æ”¶ç›Šå¢åŠ 50%"],
                    evolvedEffect: { stealFromAllPerTurn: 50, tradeBonusPercent: 50 },
                    sound: "phoenixSound",
                    image: "https://imgur.com/bmygtSe.jpg"
                },
                "ç„æ­¦è­·æ³•": {
                    cost: [{ type: "wealth", amount: 100 }, { type: "cards", amount: 3 }],
                    benefits: ["æ¯å›åˆç²å¾—100éŠ€å…©", "æ‰€æœ‰è²¨ç‰©åƒ¹å€¼ç¿»å€"],
                    evolvedEffect: { wealthPerTurn: 100, doubleGoodsValue: true },
                    sound: "turtleSound",
                    image: "https://imgur.com/mdSIIkz.jpg"
                }
            };
            
            // æ›´æ–°èµ°é©¬ç¯å†…å®¹
            function updateMarquee(text, isPriority = false, duration = 30000, isSpecial = false) {
                if (isPriority || isSpecial) {
                    priorityMarqueeQueue.push({text, duration, isSpecial});
                    processMarqueeQueue();
                } else {
                    normalMarqueeQueue.push({text, duration});
                    if (!isPriorityMessage) {
                        processMarqueeQueue();
                    }
                }
            }
            
            // å¤„ç†èµ°é©¬ç¯é˜Ÿåˆ—
            function processMarqueeQueue() {
                if (priorityMarqueeQueue.length > 0) {
                    isPriorityMessage = true;
                    const message = priorityMarqueeQueue.shift();
                    showMarqueeMessage(message.text, message.duration, true, message.isSpecial);
                } else if (normalMarqueeQueue.length > 0 && !isPriorityMessage) {
                    const message = normalMarqueeQueue.shift();
                    showMarqueeMessage(message.text, message.duration, false);
                }
            }
            
            // æ˜¾ç¤ºèµ°é©¬ç¯æ¶ˆæ¯
            function showMarqueeMessage(text, duration, isPriority, isSpecial = false) {
                marqueeText.style.animation = 'none';
                marqueeText.textContent = text;
                
                if (isSpecial) {
                    marqueeText.classList.add('special');
                    marqueeText.classList.remove('priority');
                } else if (isPriority) {
                    marqueeText.classList.add('priority');
                    marqueeText.classList.remove('special');
                } else {
                    marqueeText.classList.remove('priority', 'special');
                }
                
                const textWidth = marqueeText.scrollWidth;
                const containerWidth = marqueeText.parentElement.offsetWidth;
                const distance = textWidth + containerWidth;
                const speed = distance / (duration / 1000);
                
                marqueeText.style.animation = `marquee${isPriority ? '-priority' : ''} ${duration/1000}s linear ${isPriority ? 'forwards' : 'infinite'}`;
                
                if (isPriority) {
                    setTimeout(() => {
                        isPriorityMessage = false;
                        processMarqueeQueue();
                    }, duration);
                }
            }

            // ç²å–è­·æ³•æ•ˆæœé¡å
            function getGuardianEffectClass(guardianName) {
                switch(guardianName) {
                    case "ç‰›ç¥è­·æ³•": return "guardian-effect-bull";
                    case "ç™½è™è­·æ³•": return "guardian-effect-tiger";
                    case "é’é¾è­·æ³•": return "guardian-effect-dragon";
                    case "æœ±é›€è­·æ³•": return "guardian-effect-phoenix";
                    case "ç„æ­¦è­·æ³•": return "guardian-effect-turtle";
                    default: return "";
                }
            }
            
            // ç²å–è­·æ³•é¡è‰²
            function getGuardianColor(guardianName) {
                switch(guardianName) {
                    case "ç‰›ç¥è­·æ³•": return "#8B4513";
                    case "ç™½è™è­·æ³•": return "#2c3e50";
                    case "é’é¾è­·æ³•": return "#008080";
                    case "æœ±é›€è­·æ³•": return "#FF4500";
                    case "ç„æ­¦è­·æ³•": return "#006400";
                    default: return "#3498db";
                }
            }
            
            // ç²å–è­·æ³•æ•ˆæœæ–‡æœ¬
            function getGuardianEffectText(guardianName) {
                switch(guardianName) {
                    case "ç‰›ç¥è­·æ³•": return "ç‰›ç¥è­·æ³•ä¿è­·æ•´å€‹æ—…ç¨‹ï¼Œæ¯æ¬¡äº¤æ˜“å‡ºå”®å¤šæ”¶å–50éŠ€å…©";
                    case "ç™½è™è­·æ³•": return "ç™½è™è­·æ³•è®“ä½ é¨ä¹˜åˆ°çµ‚é»ï¼Œæ¯æ¬¡å¾ç‰Œå †èƒ½å¤šæŠ½å–1å¼µå¡";
                    case "é’é¾è­·æ³•": return "é’é¾åŠ©ä½ çœ‹å®ˆå¤§å±€ï¼Œå¾ç¾åœ¨åˆ°çµæŸä¸è² é¢äº‹ä»¶å½±éŸ¿åŠæ¯å›åˆå‘å•†æœƒæ”¶å–20å…©";
                    case "æœ±é›€è­·æ³•": return "æœ±é›€å‘å°æ‰‹æŒçºŒå™´ç‘ç™¾å‘³çœŸç«ï¼Œå¯ä½¿ç”¨è¡Œå‹•é»å‘å°æ‰‹å™´ç«æ¯è¼ªæœ€å¤šæ”¶å–25å…©/1è¡Œå‹•é»=5å…©ï¼Œ";
                    case "ç„æ­¦è­·æ³•": return "ç„æ­¦å¾æ·±æµ·å¸¶ä¾†é­šç©«é€ï¼Œæ¯å€‹å›åˆå¾å•†æœƒæ”¶å–30éŠ€å…©";
                    default: return "";
                }
            }
            
            // åˆå§‹åŒ–å½©ç¥¨å·ç 
            function initLotteryNumbers() {
                lotteryNumbers.innerHTML = '';
                lotteryError.textContent = '';
                
                for (let i = 1; i <= 50; i++) {
                    const numberEl = document.createElement('div');
                    numberEl.className = 'number-circle';
                    numberEl.textContent = i;
                    numberEl.dataset.number = i;
                    
                    const colorIndex = (i - 1) % numberColors.length;
                    numberEl.style.background = numberColors[colorIndex];
                    numberEl.style.color = 'white';
                    numberEl.style.fontWeight = 'bold';
                    
                    if (selectedNumbers.includes(i)) {
                        numberEl.classList.add('taken');
                        numberEl.style.background = '#95a5a6';
                        numberEl.style.cursor = 'not-allowed';
                    }
                    
                    numberEl.addEventListener('click', function() {
                        if (this.classList.contains('taken')) return;
                        
                        document.querySelectorAll('.number-circle').forEach(el => {
                            el.classList.remove('selected');
                        });
                        this.classList.add('selected');
                        lotteryError.textContent = '';
                    });
                    
                    lotteryNumbers.appendChild(numberEl);
                }
            }
            
            // æ·»åŠ äº‹ä»¶åˆ°æ—¥å¿—
            function addEvent(text, type = 'normal', fullText = null) {
                const eventItem = document.createElement('div');
                eventItem.className = `event-item ${type === 'global' ? 'event-global' : type === 'individual' ? 'event-individual' : type === 'special' ? 'event-special' : ''}`;
                
                const timestamp = new Date().toLocaleTimeString();
                eventItem.innerHTML = `<strong>${timestamp}:</strong> ${text}`;
                
                eventsList.appendChild(eventItem);
                eventsList.scrollTop = eventsList.scrollHeight;
                
                events.push({ text, type, timestamp });
                localStorage.setItem('events', JSON.stringify(events));
                
                if (fullText) {
                    const isPriority = (type === 'global' || type === 'individual' || type === 'special');
                    updateMarquee(`${timestamp}: ${fullText}`, isPriority, 30000);
                } else {
                    updateMarquee(`${timestamp}: ${text}`, false, 15000);
                }
            }
			// åˆ›å»ºç²’å­æ•ˆæœ
function createParticleEffect(cardElement, guardianColor) {
    const particleContainer = document.createElement('div');
    particleContainer.className = 'particle-container';
// åœ¨ç©å®¶å¡ç‰‡æ¸²æŸ“æ—¶æ·»åŠ ç‰¹æ•ˆ
function enhanceEvolvedGuardians() {
    document.querySelectorAll('.player-card.has-guardian').forEach(card => {
        const playerIndex = card.querySelector('.trade-btn').getAttribute('data-index');
        const player = players[playerIndex];
        
        if (player.guardianEvolved) {
            // æ·»åŠ æ›´å¼ºçƒˆçš„ç±»å
            card.classList.add('evolved');
            
            // è·å–æŠ¤æ³•é¢œè‰²
            const guardianColor = getGuardianColor(player.activeGuardian);
            card.style.setProperty('--guardian-color', guardianColor);
            
            // æ·»åŠ ç²’å­æ•ˆæœ
            createParticleEffect(card, guardianColor);
            
            // å¢å¼ºè§‰é†’æŒ‰é’®æ•ˆæœ
            const evolutionBtn = card.querySelector('.evolution-trigger-btn');
            if (evolutionBtn) {
                evolutionBtn.classList.add('evolved');
            }
        }
    });
}
    
    // åˆ›å»ºå¤šä¸ªç²’å­
    for (let i = 0; i < 15; i++) {
        const particle = document.createElement('div');
        particle.className = 'particle';
        particle.style.setProperty('--particle-color', guardianColor);
        particle.style.setProperty('--translate-x', `${Math.random() * 40 - 20}px`);
        particle.style.left = `${Math.random() * 100}%`;
        particle.style.animationDelay = `${Math.random() * 3}s`;
        particleContainer.appendChild(particle);
    }
    
    cardElement.appendChild(particleContainer);
    
    // æ·»åŠ æµåŠ¨å…‰æ•ˆè¾¹æ¡†
    const glowBorder = document.createElement('div');
    glowBorder.className = 'glow-border';
    cardElement.appendChild(glowBorder);
    
    // æ·»åŠ è§‰é†’æ ‡è¯†
    const evolvedBadge = document.createElement('div');
    evolvedBadge.className = 'guardian-evolved-badge';
    evolvedBadge.innerHTML = 'ç¥';
    cardElement.appendChild(evolvedBadge);
}
            
            // ç©å®¶å¡ç‰‡é—ªçƒæ•ˆæœ
            function flashPlayerCard(playerIndex, color) {
                const playerCards = document.querySelectorAll('.player-card');
                if (playerIndex < playerCards.length) {
                    const card = playerCards[playerIndex];
                    card.style.animation = 'flash 1s 3';
                    card.style.color = color;
                    setTimeout(() => {
                        card.style.animation = '';
                    }, 3000);
                }
            }
            
            // ç”Ÿæˆéšæœºè´§ç‰©
            function generateRandomGoods(count) {
                const selectedGoods = [];
                for (let i = 0; i < count; i++) {
                    const randomGoods = goodsTypes[Math.floor(Math.random() * goodsTypes.length)];
                    selectedGoods.push(randomGoods);
                }
                return selectedGoods;
            }
            
            // æ¸²æŸ“ç©å®¶åˆ—è¡¨
            function renderPlayers() {
                playersList.innerHTML = '';
                
                if (players.length === 0) {
                    playersList.innerHTML = '<div class="no-players">æš«ç„¡ç©å®¶ï¼Œè«‹æ–°å¢ç©å®¶é–‹å§‹éŠæˆ²</div>';
                    return;
                }
                
                players.forEach((player, index) => {
                    const playerCard = document.createElement('div');
                    playerCard.className = 'player-card';
                    playerCard.style.borderLeftColor = player.color;
                    
                    // å¦‚æœæœ‰è­·æ³•ï¼Œæ·»åŠ ç›¸æ‡‰çš„é¡
                    if (player.activeGuardian) {
                        const guardianClass = getGuardianEffectClass(player.activeGuardian);
                        playerCard.classList.add('has-guardian', guardianClass);
                        
                        // è¨­ç½®CSSè®Šé‡ä»¥ä¾›ç™¼å…‰æ•ˆæœä½¿ç”¨
                        playerCard.style.setProperty('--guardian-color', getGuardianColor(player.activeGuardian));
                    }
                    
                    const lotteryNumbersHtml = player.lotteryNumbers && player.lotteryNumbers.length > 0 ? 
                        player.lotteryNumbers.map(num => {
                            const colorIndex = (num - 1) % numberColors.length;
                            return `<span style="background: ${numberColors[colorIndex]}; color: white; display: inline-block; margin: 3px; padding: 5px 10px; border-radius: 15px; font-size: 0.9rem;">${num}</span>`;
                        }).join('') : 'ç„¡';
                    
                    // æ£€æŸ¥æ˜¯å¦æœ‰ä»“åº“æŒ‰é’®éœ€è¦æ˜¾ç¤º
                    const warehouseButtonHtml = player.goodsCards && player.goodsCards.length > 0 ? 
                        `<button class="btn-warehouse" data-index="${index}" style="display: block;">å€‰åº« (${player.goodsCards.length})</button>` :
                        `<button class="btn-warehouse" data-index="${index}" style="display: none;">å€‰åº«</button>`;
                    
                    playerCard.innerHTML = `
                        <div class="player-header">
    <div class="player-name">${player.name}</div>
    <div class="player-header-actions">
        ${player.activeGuardian ? `
            <button class="remove-guardian-btn" data-index="${index}">è§£é™¤${player.activeGuardian}</button>
            ${player.canEvolve ? `<button class="evolution-trigger-btn" data-index="${index}">ç¥å…½è§‰é†’</button>` : ''}
        ` : ''}
        <button class="btn-danger delete-player" data-index="${index}">åˆªé™¤</button>
    </div>
</div>
                        <div class="player-stats">
                            <div class="stat-item">

                            </div>
                            <div class="stat-item">
                                <span class="stat-label">äº¤æ˜“æ¬¡æ•¸:</span>
                                <span>${player.trades}</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">å—å½±éŸ¿äº‹ä»¶:</span>
                                <span>${player.eventCount || 0}æ¬¡</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">ä¸­çæ¬¡æ•¸:</span>
                                <span>${player.wins || 0}</span>
                            </div>
                            ${player.activeGuardian ? `
                            <div class="stat-item guardian-effect ${getGuardianEffectClass(player.activeGuardian)}">
                                <span class="stat-label">å®ˆè­·ç¥åŠ æŒ:</span>
                                <span class="guardian-text">${getGuardianEffectText(player.activeGuardian)}</span>
                            </div>
                            ` : ''}
                           ${player.guardianEvolved ? `
<div class="stat-item guardian-effect evolved">
    <span class="stat-label">ç¥ç¸è¦ºé†’:</span>
    <span class="guardian-text">${player.activeGuardian}å·²è¦ºé†’ï¼ŒåŠ›é‡å¤§å¹…æå‡ï¼ç©«å¾—å…©å€åŠ æŒæ•ˆæœ</span>
    <button class="evolution-trigger-btn" data-index="${index}">ç¥å…½è§‰é†’</button>
</div>
` : ''}
                        </div>
                        ${player.guardianTrades >= 10 && !player.guardianEvolved && player.activeGuardian ? 
                        `<button class="evolution-btn" data-index="${index}">é€²åŒ–è­·æ³•</button>` : ''}
                        <div class="lottery-history">
                            <div class="stat-label">æ­·å²å½©åˆ¸è™Ÿç¢¼:</div>
                            ${lotteryNumbersHtml}
                        </div>

                        <!-- ç¥ç§˜å•†äººå¡ç‰‡åŒºåŸŸ -->
                        ${player.cards && player.cards.length > 0 ? `
                        <div class="player-cards-section">
                            <div class="stat-label">æ“æœ‰çš„å¡ç‰‡:</div>
                            <div class="cards-container">
                        ${player.cards.map(card => 
                            `<div class="player-card-item ${card.rarity || 'normal'}" data-player-index="${index}" data-card-id="${card.id}">${card.name}</div>`
                        ).join('')}
                            </div>
                        </div>
                        ` : ''}

                        <!-- å¹½è¡—è´§å¡ä»“åº“æŒ‰é’® -->
                        ${warehouseButtonHtml}

                        <!-- äº¤æ˜“æŒ‰é’® -->
                        <button class="trade-btn" data-index="${index}">äº¤æ˜“æˆåŠŸ</button>
                    `;
                    
                    playersList.appendChild(playerCard);
                    
                    // æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const deleteBtn = playerCard.querySelector('.delete-player');
                    deleteBtn.addEventListener('click', function() {
                        const index = parseInt(this.getAttribute('data-index'));
                        players.splice(index, 1);
                        savePlayers();
                        renderPlayers();
                    });
                    
                    const tradeBtn = playerCard.querySelector('.trade-btn');
                    tradeBtn.addEventListener('click', function() {
                        const index = parseInt(this.getAttribute('data-index'));
                        handleTradeSuccess(index);
                    });
                    
                    const warehouseBtn = playerCard.querySelector('.btn-warehouse');
                    warehouseBtn.addEventListener('click', function() {
                        const index = parseInt(this.getAttribute('data-index'));
                        openWarehouse(index);
                    });
                    
                    // æ·»åŠ è§£é™¤æŠ¤æ³•æŒ‰é’®çš„äº‹ä»¶ç›‘å¬
                    const removeGuardianBtn = playerCard.querySelector('.remove-guardian-btn');
                    if (removeGuardianBtn) {
                        removeGuardianBtn.addEventListener('click', function() {
                            const index = parseInt(this.getAttribute('data-index'));
                            removeGuardianEffect(index);
                        });
                    }
                    
                    // æ·»åŠ è¿›åŒ–æŒ‰é’®çš„äº‹ä»¶ç›‘å¬
                    const evolutionBtn = playerCard.querySelector('.evolution-btn');
                    if (evolutionBtn) {
                        evolutionBtn.addEventListener('click', function() {
                            const index = parseInt(this.getAttribute('data-index'));
                            handleGuardianEvolution(index);
                        });
                    }
                    
                    // æ·»åŠ ç¥å…½è§‰é†’æŒ‰é’®çš„äº‹ä»¶ç›‘å¬
                    const evolutionTriggerBtn = playerCard.querySelector('.evolution-trigger-btn');
                    if (evolutionTriggerBtn) {
                        evolutionTriggerBtn.addEventListener('click', function() {
                            const index = parseInt(this.getAttribute('data-index'));
                            
                        });
                    }
                });
                
                attachCardEvents();
            }
            
            // ä¸ºå¡ç‰‡æ·»åŠ ç‚¹å‡»äº‹ä»¶
            function attachCardEvents() {
                document.querySelectorAll('.player-card-item').forEach(cardEl => {
                    cardEl.addEventListener('click', function() {
                        const playerIndex = parseInt(this.getAttribute('data-player-index'));
                        const cardId = parseInt(this.getAttribute('data-card-id'));
                        useCard(playerIndex, cardId);
                    });
                });
            }
            
            // æ‰“å¼€ä»“åº“
            function openWarehouse(playerIndex) {
                currentPlayerForWarehouse = playerIndex;
                const player = players[playerIndex];
                
                warehouseCardsEl.innerHTML = '';
                
                if (player.goodsCards && player.goodsCards.length > 0) {
                    player.goodsCards.forEach((card, index) => {
                        const cardEl = document.createElement('div');
                        cardEl.className = `warehouse-card ${card.rarity}`;
                        cardEl.dataset.cardIndex = index;
                        
                        // ç”Ÿæˆè´§ç‰©åœ†åœˆ
                        const goodsCirclesHtml = card.goods.map(good => 
                            `<div class="goods-circle ${good.color}" title="${good.name}">${good.name.charAt(0)}</div>`
                        ).join('');
                        
                        cardEl.innerHTML = `
                            <div class="card-name">${card.name}</div>
                            <div class="card-circles">${goodsCirclesHtml}</div>
                            <div class="card-prices">
                                <div>è²·å…¥: ${card.buyPrice}å…©</div>
                                <div>è³£å‡º: ${card.sellPrice}å…©</div>
                            </div>
                            <div class="card-desc">é»æ“Šé¸æ“‡ä½¿ç”¨æ­¤è²¨å¡</div>
                        `;
                        
                        cardEl.addEventListener('click', function() {
                            document.querySelectorAll('.warehouse-card').forEach(el => {
                                el.classList.remove('selected');
                            });
                            this.classList.add('selected');
                            selectedGoodsCardId = index;
                            warehouseError.textContent = '';
                        });
                        
                        warehouseCardsEl.appendChild(cardEl);
                    });
                } else {
                    warehouseCardsEl.innerHTML = '<p>å€‰åº«ä¸­æ²’æœ‰è²¨ç‰©äº¤æ˜“å¡</p>';
                }
                
                warehouseModal.style.display = 'flex';
                selectedGoodsCardId = null;
            }
            
            // ä½¿ç”¨å¹½è¡—è´§å¡
            function useGoodsCard() {
                if (selectedGoodsCardId === null) {
                    warehouseError.textContent = 'è«‹é¸æ“‡ä¸€å¼µè²¨ç‰©äº¤æ˜“å¡';
                    return;
                }
                
                const player = players[currentPlayerForWarehouse];
                const card = player.goodsCards[selectedGoodsCardId];
                
                // æ£€æŸ¥æ˜¯å¦æœ‰è¶³å¤Ÿé“¶ä¸¤è´­ä¹°
                if (player.wealth < card.buyPrice) {
                    warehouseError.textContent = `éŠ€å…©ä¸è¶³ï¼Œéœ€è¦ ${card.buyPrice} å…©è³¼è²·é€™äº›è²¨ç‰©`;
                    return;
                }
                
                // æ‰£é™¤é“¶ä¸¤
                player.wealth -= card.buyPrice;
                
                // æ·»åŠ äº‹ä»¶æ—¥å¿—
                addEvent(`${player.name} å¾å¹½è¡—è²¨ç‰©å€‰åº«æ‹¿å‡ºäº†å¹½è¡—è²¨å¡è²¨ç‰©`, 'special');
                
                // ç§»é™¤ä½¿ç”¨çš„å¡ç‰‡
                player.goodsCards.splice(selectedGoodsCardId, 1);
                
                // æ›´æ–°èµ°é©¬ç¯
                updateMarquee(`${player.name} é‡åˆ°äº†ç¥ç§˜å®¢äººï¼Œç²å¾—å¹½è¡—è²¨ç‰©äº¤æ˜“å¡ï¼`, true, 30000, true);
                
                // ä¿å­˜å¹¶æ›´æ–°ç•Œé¢
                savePlayers();
                renderPlayers();
                
                // å…³é—­ä»“åº“
                warehouseModal.style.display = 'none';
            }
            
            // å¤„ç†äº¤æ˜“æˆåŠŸ
            function handleTradeSuccess(playerIndex) {
                const player = players[playerIndex];
                playSound('tradeSound');
                player.trades++;
                totalTrades++;
                player.wealth = (player.wealth || 50) + 10;
                
// å¦‚æœæœ‰æŠ¤æ³•ï¼Œå¢åŠ æŠ¤æ³•äº¤æ˜“æ¬¡æ•°
if (player.activeGuardian && !player.guardianEvolved) {
    player.guardianTrades = (player.guardianTrades || 0) + 1;
    
    // æ£€æŸ¥æ˜¯å¦è¾¾åˆ°è¿›åŒ–æ¡ä»¶
    if (player.guardianTrades >= 10) {
        player.canEvolve = true;
        addEvent(`${player.name} çš„${player.activeGuardian}æ„Ÿå—é€±èº«å·²ç¸ˆç¹èµ·èºå‹•çš„éˆæ¯ï¼Œé‚£è‚¡è“„å‹¢å¾…ç™¼çš„åŠ›é‡æ­£æ‚„ç„¶ç¿»æ¹§â€”â€” æ­¤åˆ»ï¼Œæ­£æ˜¯ç¥‚è¿æ¥è¦ºé†’çš„æ™‚æ©Ÿã€çªç ´ç•Œé™çš„æ™‚åˆ»ï¼`, 'special');
        updateMarquee(`${player.name} çš„${player.activeGuardian}å·²ç´¯ç©è¶³å¤ äº¤æ˜“æ¬¡æ•¸ï¼Œå¯ä»¥é€²åŒ–äº†ï¼`, true, 30000);
    }
}
                
                savePlayers();
                addEvent(`${player.name} æˆåŠŸäº†ä¸€æ¬¡äº¤æ˜“`);
                
                // éšæœºè§¦å‘ç¯å¢ƒäº‹ä»¶ï¼ˆ30%æ¦‚ç‡ï¼‰- ç‹¬ç«‹è§¦å‘ï¼Œä¸å½±å“å…¶ä»–ç³»ç»Ÿ
                if (Math.random() < 0.35) {
                    triggerRandomEvent(playerIndex);
                }
                
                // éšæœºè§¦å‘ç¥ç§˜å•†äººï¼ˆ15%æ¦‚ç‡ï¼‰- è§¦å‘æ—¶ä¼šé˜»æ­¢å½©ç¥¨é€‰æ‹©
                let merchantTriggered = false;
                if (Math.random() < 0.45) {
                    triggerMysteriousMerchant(playerIndex);
                    merchantTriggered = true;
                }
                
                // éšæœºè§¦å‘ç¥å…½è§‰é†’ï¼ˆ5%æ¦‚ç‡ï¼‰
                if (Math.random() < 0.05 && player.activeGuardian && !player.guardianEvolved) {
                    triggerEvolution(playerIndex);
                }
                
                // æ£€æŸ¥æ˜¯å¦éœ€è¦ç«çŒœç¯èŠ‚ï¼ˆæ¯6æ¬¡äº¤æ˜“ï¼‰
                let guessTriggered = false;
                if (totalTrades % 6 === 0) {
                    guessTriggered = true;
                    setTimeout(() => {
                        guessModal.style.display = 'flex';
                        updateMarquee("ç«¶çŒœç’°ç¯€é–‹å§‹ï¼è«‹ç©å®¶å€‘äº’ç›¸çŒœæ¸¬å°æ–¹çš„éŠ€å…©æ•¸ç›®", true, 30000);
                        
                        // è®¾ç½®ç«çŒœç¯èŠ‚å…³é—­æ—¶çš„å›è°ƒ
                        const closeGuessHandler = function() {
                            // åªæœ‰æœªè§¦å‘ç¥ç§˜å•†äººçš„æƒ…å†µä¸‹æ‰æ˜¾ç¤ºå½©ç¥¨é€‰æ‹©
                            if (!merchantTriggered) {
                                // æ˜¾ç¤ºå½©ç¥¨é€‰æ‹©
                                currentPlayerForLottery = playerIndex;
                                initLotteryNumbers();
                                lotteryModal.style.display = 'flex';
                                
                                // æ›´æ–°èµ°é©¬ç¯
                                updateMarquee(`${player.name} å®Œæˆäº†ä¸€æ¬¡äº¤æ˜“ï¼Œè¯·é€‰æ‹©å½©ç¥¨å·ç `);
                            }
                            
                            // ç§»é™¤äº‹ä»¶ç›‘å¬å™¨ï¼Œé¿å…é‡å¤ç»‘å®š
                            closeGuessBtn.removeEventListener('click', closeGuessHandler);
                            closeGuessBtn2.removeEventListener('click', closeGuessHandler);
                        };
                        
                        // æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                        closeGuessBtn.addEventListener('click', closeGuessHandler);
                        closeGuessBtn2.addEventListener('click', closeGuessHandler);
                    }, 1500);
                }
                
                // å¦‚æœæ²¡æœ‰è§¦å‘ç«çŒœç¯èŠ‚ï¼Œæ­£å¸¸æ˜¾ç¤ºå½©ç¥¨é€‰æ‹©
                if (!guessTriggered && !merchantTriggered) {
                    // æ˜¾ç¤ºå½©ç¥¨é€‰æ‹©
                    currentPlayerForLottery = playerIndex;
                    initLotteryNumbers();
                    lotteryModal.style.display = 'flex';
                    
                    // æ›´æ–°èµ°é©¬ç¯
                    updateMarquee(`${player.name} å®Œæˆäº†ä¸€æ¬¡äº¤æ˜“ï¼Œè¯·é€‰æ‹©å½©ç¥¨å·ç `);
                }
                
                // é‡æ–°æ¸²æŸ“ç©å®¶åˆ—è¡¨
                renderPlayers();
                
                // æ£€æŸ¥æ˜¯å¦éœ€è¦å¼€å¥–ï¼ˆæ¯4æ¬¡äº¤æ˜“ï¼‰
                if (totalTrades % 4 === 0) {
                    setTimeout(conductLotteryDraw, 1000);
                }
            }

            
            // å¤„ç†æŠ¤æ³•è¿›åŒ–
            function handleGuardianEvolution(playerIndex) {
                const player = players[playerIndex];
                
                if (!player.activeGuardian) {
                    addEvent(`${player.name} æ²’æœ‰è­·æ³•ï¼Œç„¡æ³•é€²åŒ–`, 'individual');
                    return;
                }
                
                if (player.guardianEvolved) {
                    addEvent(`${player.name} çš„${player.activeGuardian}å·²ç¶“é€²åŒ–éäº†`, 'individual');
                    return;
                }
                
                const evolutionData = guardianEvolutionData[player.activeGuardian];
                
                if (!evolutionData) {
                    addEvent(`${player.name} çš„${player.activeGuardian}æ²’æœ‰é€²åŒ–æ•¸æ“š`, 'individual');
                    return;
                }
                
                currentEvolutionPlayerIndex = playerIndex;
                
                // è¨­ç½®é€²åŒ–æè¿°
                evolutionDesc.textContent = `ç¢ºå®šè¦é€²åŒ–æ‚¨çš„${player.activeGuardian}å—ï¼Ÿ`;
                
                // è¨­ç½®æ¶ˆè€—ææ–™
                evolutionCostList.innerHTML = evolutionData.cost.map(item => 
                    `<div>${item.amount} ${item.type === "wealth" ? "éŠ€å…©" : "å¼µå¡ç‰‡"}</div>`
                ).join('');
                
                // è¨­ç½®é€²åŒ–å¥½è™•
                evolutionBenefitsList.innerHTML = evolutionData.benefits.map(
                    benefit => `<div>â€¢ ${benefit}</div>`
                ).join('');
                
                // é¡¯ç¤ºé€²åŒ–æ¨¡æ…‹æ¡†
                evolutionModal.style.display = 'flex';
                evolutionError.textContent = '';
            }
            
// ç¢ºèªé€²åŒ–
function confirmEvolution() {
    const player = players[currentEvolutionPlayerIndex];
    const evolutionData = guardianEvolutionData[player.activeGuardian];
    
    // ç§»é™¤åŸæœ‰çš„ææ–™æ£€æŸ¥é€»è¾‘ï¼Œæ”¹ä¸ºç›´æ¥æç¤º
    const costText = evolutionData.cost.map(item => 
        `${item.amount} ${item.type === "wealth" ? "é“¶ä¸¤" : "å¼ å¡ç‰‡"}`
    ).join(' å’Œ ');
    
    // æ˜¾ç¤ºææ–™æç¤ºï¼ˆä½†ä¸é˜»æ­¢è¿›åŒ–ï¼‰
    evolutionError.textContent = `è¿›åŒ–éœ€è¦: ${costText}`;
    
    // ç›´æ¥æ‰§è¡Œè¿›åŒ–ï¼Œä¸æ£€æŸ¥ææ–™
    // æ‰£é™¤ææ–™ï¼ˆå¯é€‰ï¼Œå¦‚æœæ‚¨æƒ³å®Œå…¨ç§»é™¤ææ–™éœ€æ±‚ï¼Œå¯ä»¥æ³¨é‡Šæ‰è¿™éƒ¨åˆ†ï¼‰
    deductMaterials(player, evolutionData.cost);
    
    // æ¨™è¨˜ç‚ºå·²é€²åŒ–
    player.guardianEvolved = true;
    player.canEvolve = false;
    player.guardianEvolutionData = evolutionData;
    
    // å¢å¼·è­·æ³•æ•ˆæœ
    if (!player.guardianEffects) player.guardianEffects = {};
    Object.assign(player.guardianEffects, evolutionData.evolvedEffect);
    
    // ä¿å­˜ä¸¦æ›´æ–°ç•Œé¢
    savePlayers();
    renderPlayers();
    
    // é¡¯ç¤ºé€²åŒ–å‹•ç•«
    showEvolutionAnimation(player.activeGuardian, evolutionData);
    
    // é—œé–‰æ¨¡æ…‹æ¡†
    evolutionModal.style.display = 'none';
    
    // æ·»åŠ äº‹ä»¶æ—¥å¿—
    addEvent(`${player.name} çš„${player.activeGuardian}é€²åŒ–äº†ï¼`, 'special');
    updateMarquee(`${player.name} çš„${player.activeGuardian}è¦ºé†’äº†ï¼Œç²å¾—å¼·å¤§åŠ›é‡ï¼`, true, 30000);
}
            
            // æª¢æŸ¥æ˜¯å¦æœ‰è¶³å¤ ææ–™
            function hasEnoughMaterials(player, cost) {
                for (const item of cost) {
                    if (item.type === "wealth" && player.wealth < item.amount) {
                        return false;
                    }
                    if (item.type === "cards" && (!player.cards || player.cards.length < item.amount)) {
                        return false;
                    }
                }
                return true;
            }
            
            // æ‰£é™¤ææ–™
            function deductMaterials(player, cost) {
                for (const item of cost) {
                    if (item.type === "wealth") {
                        player.wealth -= item.amount;
                    }
                    if (item.type === "cards") {
                        // éš¨æ©Ÿç§»é™¤æŒ‡å®šæ•¸é‡çš„å¡ç‰‡
                        for (let i = 0; i < item.amount; i++) {
                            if (player.cards && player.cards.length > 0) {
                                const randomIndex = Math.floor(Math.random() * player.cards.length);
                                player.cards.splice(randomIndex, 1);
                            }
                        }
                    }
                }
            }
          
		  
            // é¡¯ç¤ºé€²åŒ–å‹•ç•«

            function showEvolutionAnimation(guardianName, evolutionData) {
                const evolutionEffect = document.getElementById('evolution-effect');
                const guardianArrival = document.getElementById('guardian-arrival');
                const blackOverlay = document.getElementById('black-overlay');
                
                // æ’­æ”¾é€²åŒ–éŸ³æ•ˆ
                playSound('evolutionSound');
                
                // è¨­ç½®é€²åŒ–å¾Œçš„åœ–ç‰‡
                const evolvedImage = evolvedGuardianImages[getGuardianClass(guardianName)];
               guardianArrival.style.backgroundImage = `url(${evolvedImage || evolutionData.image})`;
                
                // é¡¯ç¤ºé»‘è‰²é®ç½©
                blackOverlay.style.display = 'block';
                setTimeout(() => {
                    blackOverlay.classList.add('active');
                }, 100);
                
                // é¡¯ç¤ºé€²åŒ–ç‰¹æ•ˆ
                evolutionEffect.style.display = 'flex';
                setTimeout(() => {
                    evolutionEffect.classList.add('active');
                }, 100);
                
                // é¡¯ç¤ºè­·æ³•é™è‡¨æ•ˆæœ
                guardianArrival.className = `guardian-arrival ${getGuardianClass(guardianName)} evolved`;
                guardianArrival.style.display = 'block';
                
                // è§¸ç™¼å‹•ç•« - å¾ä¸Šæ–¹é™è½
                setTimeout(() => {
                    guardianArrival.classList.add('active');
                    
                    // åœç•™7ç§’å¾Œé–‹å§‹æ·¡åŒ–
                    setTimeout(() => {
                        evolutionEffect.classList.remove('active');
                        guardianArrival.classList.add('fade-out');
                        blackOverlay.classList.add('fade-out');
                        
                        // å®Œå…¨æ·¡åŒ–å¾Œéš±è—
                        setTimeout(() => {
                            evolutionEffect.style.display = 'none';
                            guardianArrival.style.display = 'none';
                            blackOverlay.style.display = 'none';
                            evolutionEffect.classList.remove('active');
                            guardianArrival.classList.remove('active', 'fade-out');
                            blackOverlay.classList.remove('active', 'fade-out');
                        }, 5000);
                    }, 7000);
                }, 100);
            }
            
            // ç²å–è­·æ³•é¡å
            function getGuardianClass(guardianName) {
                switch(guardianName) {
                    case "ç‰›ç¥è­·æ³•": return "bull";
                    case "ç™½è™è­·æ³•": return "tiger";
                    case "é’é¾è­·æ³•": return "dragon";
                    case "æœ±é›€è­·æ³•": return "phoenix";
                    case "ç„æ­¦è­·æ³•": return "turtle";
                    default: return "";
                }
            }
            
            // è§¦å‘ç¥å…½è§‰é†’
            function triggerEvolution(playerIndex) {
                const player = players[playerIndex];
                
                if (!player.activeGuardian) {
                    addEvent(`${player.name} æ²’æœ‰è­·æ³•ï¼Œç„¡æ³•è¦ºé†’`, 'individual');
                    return;
                }
                
                if (player.guardianEvolved) {
                    addEvent(`${player.name} çš„${player.activeGuardian}å·²ç¶“è¦ºé†’éäº†`, 'individual');
                    return;
                }
                
                // éšæœºå†³å®šæ˜¯å¦è§‰é†’æˆåŠŸï¼ˆ70%æˆåŠŸç‡ï¼‰
                if (Math.random() < 0.7) {
                    player.guardianEvolved = true;
                    const evolutionData = guardianEvolutionData[player.activeGuardian];
                    
                    if (evolutionData) {
                        // å¢å¼·è­·æ³•æ•ˆæœ
                        if (!player.guardianEffects) player.guardianEffects = {};
                        Object.assign(player.guardianEffects, evolutionData.evolvedEffect);
                        
                        // ä¿å­˜ä¸¦æ›´æ–°ç•Œé¢
                        savePlayers();
                        renderPlayers();
                        
                        // é¡¯ç¤ºé€²åŒ–å‹•ç•«
                        showEvolutionAnimation(player.activeGuardian, evolutionData);
                        
                        // æ·»åŠ äº‹ä»¶æ—¥å¿—
                        addEvent(`${player.name} çš„${player.activeGuardian}æˆåŠŸè¦ºé†’ï¼`, 'special');
                        updateMarquee(`${player.name} çš„${player.activeGuardian}åœ¨ç¥ç§˜åŠ›é‡ä½œç”¨ä¸‹è¦ºé†’äº†ï¼`, true, 30000);
                    }
                } else {
                    // è§‰é†’å¤±è´¥
                    addEvent(`${player.name} çš„${player.activeGuardian}è¦ºé†’å¤±æ•—äº†`, 'individual');
                    updateMarquee(`${player.name} çš„${player.activeGuardian}è¦ºé†’å¤±æ•—ï¼Œéœ€è¦æ›´å¤šä¿®ç…‰`, true, 15000);
                }
            }
            
            // è§¦å‘éšæœºäº‹ä»¶
            function triggerRandomEvent(playerIndex) {
                const event = environmentEvents[Math.floor(Math.random() * environmentEvents.length)];
                const player = players[playerIndex];
                
                player.eventCount = (player.eventCount || 0) + 1;
                
                if (event.type === 'global') {
                    addEvent(event.shortText, 'global', event.fullText);
                    players.forEach((p, idx) => {
                        p.eventCount = (p.eventCount || 0) + 1;
                        flashPlayerCard(idx, p.color);
                    });
                } else if (event.type === 'special') {
                    // å¤„ç†ç‰¹åˆ«äº‹ä»¶ - è·å¾—å¹½è¡—è´§å¡
                    addEvent(`${player.name} ${event.shortText}`, 'special', event.fullText);
                    flashPlayerCard(playerIndex, player.color);
                    
                    if (event.effect === "getGoodsCards") {
                        // ä¸ªäººè·å¾—è´§å¡
                        giveGoodsCardsToPlayer(playerIndex);
                    } else if (event.effect === "allGetGoodsCards") {
                        // å…¨ä½“è·å¾—è´§å¡
                        players.forEach((p, idx) => {
                            giveGoodsCardsToPlayer(idx);
                        });
                    }
                } else {
                    addEvent(`${player.name} ${event.shortText}`, 'individual', event.fullText);
                    flashPlayerCard(playerIndex, player.color);
                }
                
                savePlayers();
                renderPlayers();
            }
            
            // ç»™ç©å®¶å¹½è¡—è´§å¡
            function giveGoodsCardsToPlayer(playerIndex) {
                playSound('getGoodsSound'); 
                const player = players[playerIndex];
                const cardsToGive = Math.floor(Math.random() * 2) + 1; // 1-2å¼ å¡
                
                if (!player.goodsCards) {
                    player.goodsCards = [];
                }
                
                for (let i = 0; i < cardsToGive; i++) {
                    const randomCardIndex = Math.floor(Math.random() * goodsCardLibrary.length);
                    const cardTemplate = goodsCardLibrary[randomCardIndex];
                    
                    // åˆ›å»ºæ–°çš„è´§å¡å®ä¾‹
                    const newCard = {
                        id: cardTemplate.id,
                        name: cardTemplate.name,
                        rarity: cardTemplate.rarity,
                        goodsCount: cardTemplate.goodsCount,
                        buyPrice: cardTemplate.buyPrice,
                        sellPrice: cardTemplate.sellPrice,
                        goods: generateRandomGoods(cardTemplate.goodsCount)
                    };
                    
                    player.goodsCards.push(newCard);
                }
                
                addEvent(`${player.name} ç²å¾—äº† ${cardsToGive} å¼µå¹½è¡—è²¨ç‰©äº¤æ˜“å¡`, 'special');
            }
            
            // è§¦å‘ç¥ç§˜å•†äºº
            function triggerMysteriousMerchant(playerIndex) {
                currentPlayerForMerchant = playerIndex;
                const player = players[playerIndex];
                
                updateMarquee(`${player.name} é‡åˆ°äº†ç¥ç§˜å•†äººï¼è¯·ä¸ä»–äº¤æ˜“å§`, true, 30000);
                
                const selectedCards = [];
                const availableCards = [...merchantCardLibrary];
                
                for (let i = availableCards.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [availableCards[i], availableCards[j]] = [availableCards[j], availableCards[i]];
                }
                
                for (let i = 0; i < Math.min(8, availableCards.length); i++) {
                    selectedCards.push(availableCards[i]);
                }
                
                merchantCardsEl.innerHTML = '';
                selectedCards.forEach(card => {
                    const cardEl = document.createElement('div');
                    cardEl.className = `merchant-card ${card.rarity}`;
                    cardEl.dataset.cardId = card.id;
                    
                    const rarityNames = {
                        'normal': 'æ™®é€šå¡', 'magic': 'é­”æ³•å¡', 'rare': 'ç¨€æœ‰å¡',
                        'epic': 'å²è©©å¡', 'legendary': 'å‚³å¥‡å¡', 'divine': 'ç¥è–å¡'
                    };
                    
                    cardEl.innerHTML = `
                        <div class="card-name">${card.name}</div>
                        <div class="card-rarity">${rarityNames[card.rarity] || card.rarity}</div>
                        <div class="card-cost">${card.cost}æ‰‹ç‰Œ</div>
                        <div class="card-desc">${card.description}</div>
                    `;
                    
                    cardEl.addEventListener('click', function() {
                        document.querySelectorAll('.merchant-card').forEach(el => {
                            el.classList.remove('selected');
                        });
                        this.classList.add('selected');
                        selectedCardId = card.id;
                        merchantError.textContent = '';
                    });
                    
                    merchantCardsEl.appendChild(cardEl);
                });
                
                merchantModal.style.display = 'flex';
                selectedCardId = null;
            }
            
            function conductLotteryDraw() {
                playSound('lotterySound');
                updateMarquee(`å‡†å¤‡å¼€å§‹æŠ½å–ç¬¬${lotteryRound}æœŸçš„å½©ç¥¨ï¼Œç´¯è®¡å¥–é‡‘: ${jackpot}ä¸¤`);
                
                setTimeout(() => {
                    drawModal.style.display = 'flex';
                    lotteryRoundEl.textContent = lotteryRound;
                    jackpotAmountEl.textContent = jackpot;
                    
                    const drawNumberEl = document.createElement('div');
                    drawNumberEl.className = 'draw-number';
                    drawNumberEl.textContent = '?';
                    drawAnimation.innerHTML = '';
                    drawAnimation.appendChild(drawNumberEl);
                    
                    const winningNumber = Math.floor(Math.random() * 50) + 1;
                    
                    let counter = 0;
                    const interval = setInterval(() => {
                        counter++;
                        drawNumberEl.textContent = Math.floor(Math.random() * 50) + 1;
                        
                        if (counter > 20) {
                            clearInterval(interval);
                            drawNumberEl.textContent = winningNumber;
                            
                            const winners = players.filter(player => 
                                player.lotteryNumbers && player.lotteryNumbers.includes(winningNumber)
                            );
                            
                            if (winners.length > 0) {
                                playSound('lotteryWinSound');
                                winnerDisplay.innerHTML = `<h3>ä¸­å¥–å·ç : ${winningNumber}</h3>`;
                                winners.forEach(winner => {
                                    winner.wins = (winner.wins || 0) + 1;
                                    winner.wealth = (winner.wealth || 50) + jackpot;
                                    winnerDisplay.innerHTML += `<p>${winner.name} ä¸­å¥–ï¼Œè·å¾— ${jackpot} ä¸¤å¥–é‡‘ï¼</p>`;
                                    addEvent(`${winner.name} å½©ç¥¨ä¸­å¥–ï¼Œè·å¾—${jackpot}ä¸¤å¥–é‡‘ï¼`, 'individual');
                                    
                                    const winnerIndex = players.findIndex(p => p.name === winner.name);
                                    if (winnerIndex !== -1) flashPlayerCard(winnerIndex, winner.color);
                                });
                                
                                // é‡ç½®å¥–æ± å’Œå½©ç¥¨å·ç ï¼ˆåªæœ‰åœ¨æœ‰äººä¸­å¥–æ—¶ï¼‰
                                jackpot = 10;
                                selectedNumbers = [];
                                players.forEach(player => {
                                    player.lotteryNumbers = [];
                                });
                                
                                addEvent(`ç¬¬${lotteryRound}æœŸå½©ç¥¨å¼€å¥–å®Œæ¯•ï¼Œ${winners.map(w => w.name).join('å’Œ')} ä¸­å¥–ï¼Œæ‰€æœ‰å½©ç¥¨æ•°æ®å·²é‡ç½®`);
                                updateMarquee(`ç¬¬${lotteryRound}æœŸå½©ç¥¨å¼€å¥–ï¼Œå·ç  ${winningNumber}ï¼Œ${winners.map(w => w.name).join('å’Œ')} ä¸­å¥–ï¼å¥–æ± å·²é‡ç½®ã€‚`, true, 30000);
                            } else {
                                winnerDisplay.innerHTML = `<h3>ä¸­å¥–å·ç : ${winningNumber}</h3>
                                                          <p>æ²¡æœ‰äººä¸­å¥–ï¼å¥–æ± ç´¯è®¡åˆ°ä¸‹ä¸€è½®ï¼š${jackpot + 10}ä¸¤</p>`;
                                addEvent(`å½©ç¥¨å¼€å¥–ï¼Œå·ç  ${winningNumber}ï¼Œæ— äººä¸­å¥–ï¼Œå¥–æ± ç´¯è®¡åˆ° ${jackpot + 10}ä¸¤`);
                                
                                jackpot += 10;
                                updateMarquee(`ç¬¬${lotteryRound}æœŸå½©ç¥¨å¼€å¥–ï¼Œå·ç  ${winningNumber}ï¼Œæ— äººä¸­å¥–ï¼Œå¥–æ± ç´¯è®¡åˆ° ${jackpot}ä¸¤`, true, 30000);
                            }
                            
                            lotteryRound++;
                            savePlayers();
                            renderPlayers();
                        }
                    }, 100);
                }, 3000);
            }
            
            // ä½¿ç”¨å¡ç‰‡
            function useCard(playerIndex, cardId) {
                const player = players[playerIndex];
                const cardIndex = player.cards.findIndex(c => c.id == cardId);
                
                if (cardIndex === -1) return;
                
                const card = player.cards[cardIndex];
                currentCardToUse = card;
                currentCardPlayerIndex = playerIndex;
                
                // æ£€æŸ¥æ˜¯å¦æ˜¯æŠ¤æ³•å¡ç‰‡
                const isGuardianCard = [
                    "ç‰›ç¥è­·æ³•", "ç™½è™è­·æ³•", "é’é¾è­·æ³•", "æœ±é›€è­·æ³•", "ç„æ­¦è­·æ³•"
                ].includes(card.name);
                
                useCardDesc.textContent = `ç¡®å®šè¦ä½¿ç”¨ã€${card.name}ã€‘å¡ç‰‡å—ï¼Ÿæ•ˆæœ: ${card.description}`;
                useCardModal.style.display = 'flex';
                useCardError.textContent = '';
                
                // ç§»é™¤åŸæœ‰çš„äº‹ä»¶ç›‘å¬å™¨ï¼Œé¿å…é‡å¤ç»‘å®š
                confirmUseCardBtn.replaceWith(confirmUseCardBtn.cloneNode(true));
                const newConfirmBtn = document.getElementById('confirm-use-card');
                
                // æ ¹æ®å¡ç‰‡ç±»å‹ç»‘å®šä¸åŒçš„äº‹ä»¶å¤„ç†å‡½æ•°
                if (isGuardianCard) {
                    newConfirmBtn.addEventListener('click', executeGuardianEffect);
                } else {
                    newConfirmBtn.addEventListener('click', executeCardEffect);
                }
            }
            
            // æ‰§è¡ŒæŠ¤æ³•å¡ç‰‡æ•ˆæœ
            function executeGuardianEffect() {
                const player = players[currentCardPlayerIndex];
                const card = currentCardToUse;
                
                // æ£€æŸ¥æ˜¯å¦å·²æœ‰æŠ¤æ³•æ•ˆæœ
                if (player.activeGuardian) {
                    useCardError.textContent = `æ‚¨å·²æœ‰${player.activeGuardian}ä¿è­·ï¼Œè«‹å…ˆè§£é™¤ç•¶å‰è­·æ³•æ•ˆæœ`;
                    return;
                }
                
                // è·å–æŠ¤æ³•é™ä¸´å…ƒç´ å’Œé»‘è‰²é®ç½©å…ƒç´ 
                const guardianArrival = document.getElementById('guardian-arrival');
                const blackOverlay = document.getElementById('black-overlay');
                
                // æ˜¾ç¤ºé»‘è‰²é®ç½©
                blackOverlay.style.display = 'block';
                setTimeout(() => {
                    blackOverlay.classList.add('active');
                }, 100);
                
                // æ ¹æ®å¡ç‰‡ç±»å‹åº”ç”¨ä¸åŒæ•ˆæœ
                let guardianClass = '';
                switch(card.name) {
                    case "ç‰›ç¥è­·æ³•":
                        playSound('bullSound');
                        player.activeGuardian = "ç‰›ç¥è­·æ³•";
                        player.guardianEffects = { extraWealthPerTrade: 30 };
						        player.guardianTrades = 0; // ç¡®ä¿åˆå§‹åŒ–
        player.guardianEvolved = false; // ç¡®ä¿åˆå§‹åŒ–
        player.canEvolve = false; // ç¡®ä¿åˆå§‹åŒ–
                        guardianClass = 'bull';
                        break;
                        
                    case "ç™½è™è­·æ³•":
                        playSound('tigerSound');
                        player.activeGuardian = "ç™½è™è­·æ³•";
                        player.guardianEffects = { extraCardsPerDraw: 1 };
						        player.guardianTrades = 0; // ç¡®ä¿åˆå§‹åŒ–
        player.guardianEvolved = false; // ç¡®ä¿åˆå§‹åŒ–
        player.canEvolve = false; // ç¡®ä¿åˆå§‹åŒ–
                        guardianClass = 'tiger';
                        break;
                        
                    case "é’é¾è­·æ³•":
                        playSound('dragonSound');
                        player.activeGuardian = "é’é¾è­·æ³•";
                        player.guardianEffects = { immuneToNegativeEvents: true };
						        player.guardianTrades = 0; // ç¡®ä¿åˆå§‹åŒ–
        player.guardianEvolved = false; // ç¡®ä¿åˆå§‹åŒ–
        player.canEvolve = false; // ç¡®ä¿åˆå§‹åŒ–
                        guardianClass = 'dragon';
                        break;
                        
                    case "æœ±é›€è­·æ³•":
                        playSound('phoenixSound');
                        player.activeGuardian = "æœ±é›€è­·æ³•";
                        player.guardianEffects = { stealWealthPerTurn: 20 };
						        player.guardianTrades = 0; // ç¡®ä¿åˆå§‹åŒ–
        player.guardianEvolved = false; // ç¡®ä¿åˆå§‹åŒ–
        player.canEvolve = false; // ç¡®ä¿åˆå§‹åŒ–
                        guardianClass = 'phoenix';
                        break;
                        
                    case "ç„æ­¦è­·æ³•":
                        playSound('turtleSound');
                        player.activeGuardian = "ç„æ­¦è­·æ³•";
                        player.guardianEffects = { extraWealthPerTurn: 30 };
						        player.guardianTrades = 0; // ç¡®ä¿åˆå§‹åŒ–
        player.guardianEvolved = false; // ç¡®ä¿åˆå§‹åŒ–
        player.canEvolve = false; // ç¡®ä¿åˆå§‹åŒ–
                        guardianClass = 'turtle';
                        break;
                }
                
                // æ˜¾ç¤ºæŠ¤æ³•é™ä¸´æ•ˆæœ
                guardianArrival.className = `guardian-arrival ${guardianClass}`;
                guardianArrival.style.display = 'block';
                
                // è§¦å‘åŠ¨ç”» - ä»ä¸Šæ–¹é™è½
                setTimeout(() => {
                    guardianArrival.classList.add('active');
                    
                    // åœç•™7ç§’åå¼€å§‹æ·¡åŒ–
                    setTimeout(() => {
                        guardianArrival.classList.add('fade-out');
                        blackOverlay.classList.add('fade-out');
                        
                        // å®Œå…¨æ·¡åŒ–åéšè—
                        setTimeout(() => {
                            guardianArrival.style.display = 'none';
                            blackOverlay.style.display = 'none';
                            guardianArrival.classList.remove('active', 'fade-out');
                            blackOverlay.classList.remove('active', 'fade-out');
                        }, 5000); // æ·¡åŒ–è¿‡ç¨‹æŒç»­5ç§’
                    }, 7000); // åœç•™7ç§’
                }, 100);
                
                // ç§»é™¤ä½¿ç”¨çš„å¡ç‰‡
                const cardIndex = player.cards.findIndex(c => c.id == card.id);
                if (cardIndex !== -1) {
                    player.cards.splice(cardIndex, 1);
                }
                
                savePlayers();
                renderPlayers();
                useCardModal.style.display = 'none';
                
                addEvent(`${player.name} ä½¿ç”¨äº†ã€${card.name}ã€‘å¡ç‰‡ï¼Œç²å¾—äº†${card.name}çš„ä¿è­·`, 'special');
                updateMarquee(`${player.name} å¬å–šäº†${card.name}ï¼`, true, 30000);
            }
            
            function removeGuardianEffect(playerIndex) {
                const player = players[playerIndex];
                
    if (player.activeGuardian) {
        addEvent(`${player.name} è§£é™¤äº†${player.activeGuardian}çš„ä¿è­·`, 'special');
        player.activeGuardian = null;
        player.guardianEffects = {};
        player.guardianEvolved = false;
        player.guardianTrades = 0;
        player.canEvolve = false; // æ·»åŠ è¿™è¡Œï¼Œç¡®ä¿è§£é™¤åé‡ç½®è¿›åŒ–çŠ¶æ€
        player.guardianEvolutionData = null; // æ·»åŠ è¿™è¡Œï¼Œæ¸…é™¤è¿›åŒ–æ•°æ®
        
        savePlayers();
        renderPlayers();
		enhanceEvolvedGuardians();
    }
}
            
            // æ‰§è¡Œå¡ç‰‡æ•ˆæœ
            function executeCardEffect() {
                const player = players[currentCardPlayerIndex];
                const card = currentCardToUse;
                
                switch(card.effect) {
                    case "doubleNextTrade":
                        player.nextTradeDouble = true;
                        addEvent(`${player.name} ä½¿ç”¨äº†ã€${card.name}ã€‘ï¼Œä¸‹æ¬¡äº¤æ˜“å°†è·å¾—åŒå€æ”¶ç›Š`);
                        break;
                    case "stealWealth":
                        const otherPlayers = players.filter((p, i) => i !== currentCardPlayerIndex);
                        if (otherPlayers.length > 0) {
                            const targetIndex = Math.floor(Math.random() * otherPlayers.length);
                            const target = otherPlayers[targetIndex];
                            const stolenAmount = 10;
                            
                            if (target.wealth >= stolenAmount) {
                                target.wealth -= stolenAmount;
                                player.wealth += stolenAmount;
                                addEvent(`${player.name} ä½¿ç”¨äº†ã€${card.name}ã€‘ï¼Œä»${target.name}çªƒå–äº†${stolenAmount}ä¸¤é“¶å­`);
                            } else {
                                addEvent(`${player.name} ä½¿ç”¨äº†ã€${card.name}ã€‘ï¼Œä½†${target.name}æ²¡æœ‰è¶³å¤Ÿé“¶ä¸¤å¯çªƒå–`);
                            }
                        }
                        break;
                    case "instantWealth":
                        player.wealth += 20;
                        addEvent(`${player.name} ä½¿ç”¨äº†ã€${card.name}ã€‘ï¼Œç«‹å³è·å¾—20ä¸¤é“¶å­`);
                        break;
                    case "immuneNextNegative":
                        player.immuneNextNegative = true;
                        addEvent(`${player.name} ä½¿ç”¨äº†ã€${card.name}ã€‘ï¼Œå°†å…ç–«ä¸‹ä¸€æ¬¡è´Ÿé¢äº‹ä»¶`);
                        break;
                    default:
                        addEvent(`${player.name} ä½¿ç”¨äº†ã€${card.name}ã€‘`);
                }
                
                const cardIndex = player.cards.findIndex(c => c.id == card.id);
                if (cardIndex !== -1) {
                    player.cards.splice(cardIndex, 1);
                }
                
                updateMarquee(`${player.name} ä½¿ç”¨äº†ã€${card.name}ã€‘å¡ç‰‡`, true, 30000);
                savePlayers();
                renderPlayers();
                useCardModal.style.display = 'none';
            }
            
            // ä¿å­˜ç©å®¶æ•°æ®
            function savePlayers() {
                localStorage.setItem('players', JSON.stringify(players));
                localStorage.setItem('totalTrades', totalTrades);
                localStorage.setItem('jackpot', jackpot);
                localStorage.setItem('lotteryRound', lotteryRound);
                localStorage.setItem('selectedNumbers', JSON.stringify(selectedNumbers));
            }
            
            // åˆå§‹åŒ–
            function init() {
                players.forEach(player => {
                    if (player.cards) {
                        player.cards.forEach(card => {
                            if (!card.rarity) {
                                if (card.id <= 4) card.rarity = 'normal';
                                else if (card.id <= 6) card.rarity = 'magic';
                                else if (card.id <= 8) card.rarity = 'rare';
                                else if (card.id <= 12) card.rarity = 'epic';
                                else if (card.id <= 16) card.rarity = 'legendary';
                                else card.rarity = 'normal';
                            }
                        });
                    }
                });
                
                initLotteryNumbers();
                renderPlayers();
                updateMarquee("æ­¡è¿ä½¿ç”¨å¹½è¡—å•†äººæ¡ŒéŠå°ˆç”¨-æ²‰æµ¸è¼”åŠ©ç¨‹å¼ï¼è«‹æ–°å¢ç©å®¶ä¸¦é–‹å§‹äº¤æ˜“ã€‚");
                
                // æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                addPlayerBtn.addEventListener('click', function() {
                    const name = playerNameInput.value.trim();
                    const color = playerColorInput.value;
                    
                    if (name) {
                        players.push({
                            name: name,
                            color: color,
                            trades: 0,
                            wealth: 500,
                            eventCount: 0,
                            lotteryNumbers: [],
                            wins: 0,
                            cards: [],
                            goodsCards: [],
                            // è­·æ³•é€²åŒ–ç›¸é—œå±¬æ€§
                            activeGuardian: null,
                            guardianEffects: {},
                            guardianTrades: 0,
                            guardianEvolved: false,
                            canEvolve: false,
                            guardianEvolutionData: null
                        });
                        
                        savePlayers();
                        renderPlayers();
                        playerNameInput.value = '';
                        addEvent(`æ–°ç©å®¶ ${name} åŠ å…¥éŠæˆ²`);
                    }
                });
                
                resetGameBtn.addEventListener('click', function() {
                    if (confirm('ç¢ºå®šè¦é‡ç½®éŠæˆ²å—ï¼Ÿæ‰€æœ‰ç©å®¶è³‡æ–™å’Œäº‹ä»¶å°‡è¢«æ¸…é™¤ã€‚')) {
                        players = [];
                        events = [];
                        totalTrades = 0;
                        jackpot = 10;
                        lotteryRound = 1;
                        selectedNumbers = [];
                        localStorage.clear();
                        renderPlayers();
                        eventsList.innerHTML = '<div class="event-item"><strong>ç³»ç»Ÿæ¶ˆæ¯ï¼š</strong> éŠæˆ²å·²é‡ç½®ã€‚</div>';
                        addEvent('éŠæˆ²å·²é‡ç½®ï¼Œé‡æ–°é–‹å§‹');
                        updateMarquee("éŠæˆ²å·²é‡ç½®ï¼Œè«‹æ–°å¢ç©å®¶ä¸¦é–‹å§‹äº¤æ˜“ã€‚");
                    }
                });
                
                confirmLotteryBtn.addEventListener('click', function() {
                    const selectedNumberEl = document.querySelector('.number-circle.selected');
                    
                    if (!selectedNumberEl) {
                        lotteryError.textContent = 'è«‹é¸æ“‡ä¸€å€‹è™Ÿç¢¼';
                        return;
                    }
                    
                    const number = parseInt(selectedNumberEl.dataset.number);
                    
                    if (selectedNumbers.includes(number)) {
                        lotteryError.textContent = 'è©²è™Ÿç¢¼å·²è¢«é¸æ“‡ï¼Œè«‹é¸æ“‡å…¶ä»–è™Ÿç¢¼';
                        return;
                    }
                    
                    if (currentPlayerForLottery !== null) {
                        const player = players[currentPlayerForLottery];
                        
                        if (!player.lotteryNumbers) {
                            player.lotteryNumbers = [];
                        }
                        
                        player.lotteryNumbers.push(number);
                        selectedNumbers.push(number);
                        
                        savePlayers();
                        renderPlayers();
                        
                        addEvent(`${player.name} é¸æ“‡äº†å½©åˆ¸è™Ÿç¢¼ ${number}`);
                        lotteryModal.style.display = 'none';
                    }
                });
                
                closeLotteryBtn.addEventListener('click', function() {
                    lotteryModal.style.display = 'none';
                });
                
                closeDrawBtn.addEventListener('click', function() {
                    drawModal.style.display = 'none';
                });
                
                closeGuessBtn.addEventListener('click', function() {
                    guessModal.style.display = 'none';
                });
                
                closeGuessBtn2.addEventListener('click', function() {
                    guessModal.style.display = 'none';
                });
                
                closeMerchantBtn.addEventListener('click', function() {
                    merchantModal.style.display = 'none';
                });
                
                confirmPurchaseBtn.addEventListener('click', function() {
                    if (!selectedCardId) {
                        merchantError.textContent = 'è«‹é¸æ“‡ä¸€å¼µå¡ç‰‡';
                        return;
                    }
                    
                    const player = players[currentPlayerForMerchant];
                    const card = merchantCardLibrary.find(c => c.id == selectedCardId);
                    
                    if (player.wealth >= card.cost) {
                        player.wealth -= card.cost;
                        
                        // ç¡®ä¿cardsæ•°ç»„å­˜åœ¨
                        if (!player.cards) player.cards = [];
                        player.cards.push({...card});
                        
                        savePlayers();
                        renderPlayers();
                        
                        addEvent(`${player.name} å¾ç¥ç§˜å•†äººè³¼è²·äº†ã€${card.name}ã€‘å¡ç‰‡`);
                        merchantModal.style.display = 'none';
                        selectedCardId = null;
                        
                        updateMarquee(`${player.name} è³¼è²·äº†ã€${card.name}ã€‘å¡ç‰‡`, true, 30000);
                    } else {
                        merchantError.textContent = 'é“¶ä¸¤ä¸è¶³ï¼Œæ— æ³•è´­ä¹°æ­¤å¡ç‰‡';
                    }
                });
                
                useGoodsCardBtn.addEventListener('click', function() {
                    useGoodsCard();
                });
                
                closeWarehouseBtn.addEventListener('click', function() {
                    warehouseModal.style.display = 'none';
                });
                
                closeWarehouseBtn2.addEventListener('click', function() {
                    warehouseModal.style.display = 'none';
                });
                
                confirmUseCardBtn.addEventListener('click', function() {
                    executeCardEffect();
                    useCardModal.style.display = 'none';
                });
                
                cancelUseCardBtn.addEventListener('click', function() {
                    useCardModal.style.display = 'none';
                    currentCardToUse = null;
                    currentCardPlayerIndex = null;
                });
                
                confirmEvolutionBtn.addEventListener('click', function() {
                    confirmEvolution();
                });
                
                cancelEvolutionBtn.addEventListener('click', function() {
                    evolutionModal.style.display = 'none';
                });
                
                closeEvolutionBtn.addEventListener('click', function() {
                    evolutionModal.style.display = 'none';
                });
                
                playerNameInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        addPlayerBtn.click();
                    }
                });
                
                // éš¾åº¦é€‰æ‹©æŒ‰é’®äº‹ä»¶
                document.querySelectorAll('.difficulty-toggle span').forEach(span => {
                    span.addEventListener('click', function() {
                        document.querySelectorAll('.difficulty-toggle span').forEach(s => {
                            s.classList.remove('active');
                        });
                        this.classList.add('active');
                        
                        const difficulty = this.getAttribute('data-difficulty');
                        // è¿™é‡Œå¯ä»¥æ·»åŠ éš¾åº¦è°ƒæ•´é€»è¾‘
                        addEvent(`éŠæˆ²é›£åº¦è¨­ç½®ç‚º: ${difficulty === 'easy' ? 'ç°¡å–®' : 'å›°é›£'}`);
                    });
                });
            }
            
            // å¯åŠ¨åˆå§‹åŒ–
            init();
        });
    </script>
</body>

</html>
